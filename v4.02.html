<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>åŠ¨æ€æŠ¥ä»·è¡¨-æ­£å¼ç‰ˆ</title>
  <style>
        /* æ‰¹é‡æ·»åŠ å¼¹çª—ä¼˜åŒ–æ ·å¼ */
        #batchAddModal .modal-content {
          max-width: 420px;
          position: relative;
          z-index: 2001;
          background: #fff;
          border-radius: 14px;
          box-shadow: 0 8px 32px #0002;
          border: 1.5px solid #e5e7eb;
        }
        .size-select-list {
          display: flex;
          flex-wrap: wrap;
          gap: 10px;
          margin-bottom: 10px;
        }
        .size-option-btn {
          min-width: 60px;
          padding: 8px 16px 8px 12px;
          border-radius: 7px;
          border: 1.5px solid #e5e7eb;
          background: #f4f6fa;
          color: #222;
          font-size: 15px;
          cursor: pointer;
          transition: all 0.13s;
          margin-bottom: 4px;
          position: relative;
          box-shadow: none;
          outline: none;
          font-weight: 500;
          display: flex;
          align-items: center;
        }
        .size-option-btn.selected {
          background: #e0e7ff;
          color: var(--primary);
          border-color: var(--primary);
          box-shadow: 0 2px 8px #4361ee11;
        }
        .size-option-btn .order-badge {
          position: absolute;
          top: 4px;
          right: 6px;
          background: var(--primary);
          color: #fff;
          font-size: 11px;
          border-radius: 8px;
          padding: 0 6px;
          font-weight: bold;
          opacity: 0.92;
          pointer-events: none;
        }
        .selected-size-list { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 8px; }
        .selected-size-item {
          background: var(--highlight);
          color: var(--primary);
          border-radius: 4px;
          padding: 4px 10px 4px 8px;
          font-size: 14px;
          display: flex;
          align-items: center;
          border: 1px solid var(--primary);
        }
        .selected-size-item .remove-size {
          margin-left: 4px;
          color: var(--danger);
          font-weight: bold;
          cursor: pointer;
          font-size: 15px;
        }
        #batchAddModal .modal-content { position: relative; }
        #batchAddModal .modal-bg {
          position: fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.35); z-index:2000;
        }
    :root {
      --primary: #4361ee;
      --danger: #f72585;
      --success: #06d6a0;
      --gray: #64748b;
      --light-gray: #e2e8f0;
      --border: #cbd5e1;
      --text: #1e293b;
      --white: #ffffff;
      --shadow: 0 6px 20px rgba(0,0,0,0.12);
      --radius: 12px;
      --error: #ef4444;
      --highlight: #dbeafe;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background-color: #f8fafc;
      color: var(--text);
      padding: 24px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 24px;
    }

    h1 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 20px;
    }

    .toolbar {
      display: flex;
      gap: 14px;
      margin-bottom: 24px;
      flex-wrap: wrap;
      align-items: center;
    }

    button {
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      outline: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    #addRowBtn { background-color: var(--primary); color: white; }
    #addColumnBtn { background-color: #7209b7; color: white; }
    #exportBtn { background-color: var(--success); color: white; }
    #importBtn { background-color: #0d9488; color: white; }
    #undoBtn { 
      background-color: #64748b; 
      color: white; 
      opacity: 0.6; 
      pointer-events: none; 
    }
    #undoBtn.enabled {
      opacity: 1;
      pointer-events: auto;
    }
    #bulkDeleteBtn {
      background-color: var(--danger);
      color: white;
      opacity: 0.6;
      pointer-events: none;
    }
    #bulkDeleteBtn.enabled {
      opacity: 1;
      pointer-events: auto;
    }

    button:hover:not(:disabled) { opacity: 0.92; transform: translateY(-1px); }

    .addon-input-group {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      color: var(--gray);
    }

    #addonValueInput {
      width: 80px;
      padding: 8px 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
    }

    .import-options {
      display: flex;
      align-items: center;
      gap: 16px;
      font-size: 14px;
      color: var(--gray);
      flex-wrap: wrap;
    }

    .import-options input[type="checkbox"] {
      margin: 0;
      transform: scale(1.2);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      table-layout: auto; /* å…è®¸è¡¨æ ¼è‡ªåŠ¨è°ƒæ•´åˆ—å®½ */
      /* è®©æ¯åˆ—æœ‰æœ€å°å®½åº¦å’Œæœ€å¤§å®½åº¦ï¼Œè‡ªåŠ¨é€‚åº”å†…å®¹ */
      width: 100%;
    }

    th, td {
      padding: 12px 8px;
      text-align: center;
      border: 1px solid var(--border);
      vertical-align: middle;
      /* é…ç½®å‚æ•°ã€åŸä»·+85ã€åŸä»·åˆ—å…è®¸æ¢è¡Œå’Œå®Œæ•´æ˜¾ç¤º */
      /* min-width: 100px; å–æ¶ˆå…¨å±€æœ€å°åˆ—å®½ï¼Œäº¤ç”±thè‡ªé€‚åº” */
      /* max-width: 320px; å–æ¶ˆæœ€å¤§åˆ—å®½é™åˆ¶ */
    }

    th {
      background-color: #f1f5f9;
      position: relative;
      font-weight: 600;
      white-space: nowrap; /* è¡¨å¤´æ–‡å­—ä¸æ¢è¡Œ */
      padding: 12px 16px; /* è¡¨å¤´å¢åŠ å·¦å³å†…è¾¹è· */
      text-align: center; /* è¡¨å¤´æ–‡å­—å±…ä¸­ */
      font-size: 14px; /* ç»Ÿä¸€è¡¨å¤´å­—ä½“å¤§å° */
      line-height: 1.4; /* è®¾ç½®è¡Œé«˜é˜²æ­¢æ–‡å­—å †å  */
      width: fit-content;
      min-width: unset;
      max-width: unset;
    }

    /* ç‰¹æ®Šåˆ—çš„å®½åº¦è®¾ç½® */
    .select-all { 
      width: 50px; 
      min-width: 50px;
      max-width: 50px;
    }
    
    /* .drag-handle å®½åº¦æ ·å¼å·²ç§»é™¤ */
    
    .serial-number { 
      width: 80px; 
      min-width: 80px;
      max-width: 80px;
      text-align: center;
    }
    
    /* ç³»ç»Ÿç±»å‹åˆ— */
    th:nth-child(4),
    td:nth-child(4) {
      width: fit-content;
      min-width: unset;
      max-width: unset;
      text-align: center;
    }
    /* ç³»ç»Ÿç±»å‹å›¾æ ‡æ ·å¼ */
    .system-icon {
      font-size: 20px;
      vertical-align: middle;
      margin-right: 4px;
    }
    
    /* å°ºå¯¸åˆ— */
    th:nth-child(5),
    td:nth-child(5) {
      width: fit-content;
      min-width: unset;
      max-width: unset;
      text-align: center;
    }
    
    /* é…ç½®å‚æ•°åˆ— - å…è®¸æ›´å®½ */
    th:nth-child(6),
    td:nth-child(6) {
      width: fit-content;
      min-width: unset;
      max-width: unset;
      white-space: normal;
      overflow: visible;
      text-overflow: initial;
      word-break: break-all;
    }
    
    /* åŸä»·+85åˆ— */
    th:nth-child(7),
    td:nth-child(7) {
      width: fit-content;
      min-width: unset;
      max-width: unset;
      /* text-align: right; */
      white-space: normal;
      overflow: visible;
      text-overflow: initial;
    }
    
    /* åŸä»·åˆ— */
    th:nth-child(8),
    td:nth-child(8) {
      width: fit-content;
      min-width: unset;
      max-width: unset;
      text-align: center;
        text-align: center;
        cursor: pointer;
        padding: 0 8px;
      white-space: normal;
      overflow: visible;
      text-overflow: initial;
    }
    
    /* æ“ä½œåˆ— */
    th:last-child,
    td:last-child {
      width: fit-content;
      min-width: unset;
      max-width: unset;
      text-align: center;
    }

    /* è¡¨å¤´å†…å®¹å®¹å™¨ */
    .th-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      width: 100%;
    }

    /* è‡ªå®šä¹‰åˆ—çš„æ ·å¼ */
    .custom-column {
      width: 150px;
      min-width: 120px;
      max-width: 200px;
    }

    /* è¡¨æ ¼å®¹å™¨å“åº”å¼å¸ƒå±€ */
    .table-container {
      overflow-x: auto;
      border-radius: var(--radius);
      box-shadow: 0 0 0 1px var(--border);
      margin-top: 10px;
    }

    /* ç¡®ä¿è¡¨æ ¼åœ¨å®¹å™¨ä¸­æ­£ç¡®æ˜¾ç¤º */
    .table-container table {
      margin: 0;
      min-width: 100%;
    }

    /* å“åº”å¼è®¾è®¡ - å°å±å¹•é€‚é… */
    @media (max-width: 768px) {
      .container {
        padding: 12px;
      }
      
      th, td {
        padding: 8px 4px;
        font-size: 12px;
      }
      
      .th-content {
        font-size: 12px;
      }
      
      .select-all, .serial-number {
        width: 40px;
        min-width: 40px;
        max-width: 40px;
      }
      
      th:nth-child(4), td:nth-child(4) { /* ç³»ç»Ÿç±»å‹ */
        width: 80px;
        min-width: 80px;
        max-width: 100px;
      }
      
      th:nth-child(5), td:nth-child(5) { /* å°ºå¯¸ */
        width: 60px;
        min-width: 60px;
        max-width: 80px;
      }
      
      th:nth-child(6), td:nth-child(6) { /* é…ç½®å‚æ•° */
        width: 120px;
        min-width: 100px;
        max-width: 150px;
      }
      
      th:nth-child(7), td:nth-child(7), /* åŸä»·+85 */
      th:nth-child(8), td:nth-child(8) { /* åŸä»· */
        width: 80px;
        min-width: 80px;
        max-width: 100px;
      }
      
      th:last-child, td:last-child { /* æ“ä½œ */
        width: 100px;
        min-width: 100px;
        max-width: 100px;
      }
      
      .custom-column {
        width: 100px;
        min-width: 80px;
        max-width: 120px;
      }
    }

    /* è¶…å°å±å¹•é€‚é… */
    @media (max-width: 480px) {
      th, td {
        padding: 6px 2px;
        font-size: 11px;
      }
      
      .th-content {
        font-size: 11px;
        gap: 2px;
      }
      
      .sort-indicator {
        font-size: 10px;
      }
      
      .col-btn {
        width: 18px;
        height: 18px;
        font-size: 10px;
      }
    }

    /* æ’åºæŒ‡ç¤ºå™¨ */
    .sort-indicator {
      margin-left: 4px;
      font-size: 12px;
      color: var(--gray);
    }

    .sort-indicator.active {
      color: var(--primary);
    }

    /* åˆ—æ“ä½œæŒ‰é’®ç»„ */
    .col-actions {
      position: absolute;
      right: 6px;
      top: 50%;
      transform: translateY(-50%);
      display: none;
      gap: 4px;
    }

    th:hover .col-actions { display: flex; }

    .col-btn {
      width: 22px;
      height: 22px;
      border: none;
      border-radius: 4px;
      background: var(--gray);
      color: white;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .col-btn:hover { background: var(--primary); }

    .delete-col-btn {
      background: var(--danger) !important;
    }

    input[type="checkbox"] {
      margin: 0;
      transform: scale(1.2);
    }

    .select-all, .row-select, .serial-number {
      width: 40px;
      text-align: center;
    }

    /* .drag-handle æ‹–æ‹½æ ·å¼å·²ç§»é™¤ */

    /* è¡Œé«˜äº® */
    tr:hover td {
      background-color: var(--highlight) !important;
    }

    .selected-row td {
      background-color: #dbeafe !important;
    }

    input[type="text"], input[type="number"], select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      background: white;
    }

    input.error {
      border-color: var(--error);
      box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2);
    }

    .computed-cell {
      background-color: #f8fafc;
      color: var(--gray);
      font-style: italic;
    }

    .delete-row-btn {
      background: var(--danger);
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      font-weight: 500;
    }

    .edit-row-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      font-weight: 500;
      margin-right: 6px;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.45);
      z-index: 2000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(2px);
    }

    .modal-content {
      background: var(--white);
      border-radius: var(--radius);
      width: 520px;
      max-width: 95%;
      box-shadow: 0 12px 32px rgba(0,0,0,0.2);
      overflow: hidden;
      position: relative;
    }

    .modal-header {
      padding: 20px 24px;
      background: linear-gradient(to right, var(--primary), #3a56d4);
      color: white;
      font-size: 18px;
      font-weight: 600;
    }

    .modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      font-size: 24px;
      color: white;
      cursor: pointer;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      transition: background 0.2s;
    }

    .modal-body { padding: 24px; }
    .form-group { margin-bottom: 20px; }
    label {
      display: block;
      /* margin-bottom: 8px; */
      font-weight: 600;
      color: var(--text);
      font-size: 14px;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      padding: 0 24px 24px;
    }

    .btn-secondary {
      background-color: var(--light-gray);
      color: var(--text);
      font-weight: 600;
    }

    .btn-primary {
      background-color: var(--primary);
      color: white;
      font-weight: 600;
    }

    #csvFileInput { display: none; }

    .flex-label {
      display: flex;
      justify-content: center;
    }
    #clearBeforeImport,#importSortAsc {
      margin-right: 5px;
    }
    
    /* ç¿»é¡µæ§ä»¶æ ·å¼ */
    .pagination-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
      padding: 10px 0;
    }
    
    .page-info {
      font-size: 14px;
      color: var(--text);
    }
    
    .page-buttons {
      display: flex;
      gap: 8px;
    }
    
    .page-btn {
      padding: 8px 12px;
      border: 1px solid var(--border);
      background-color: var(--white);
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .page-btn.active {
      background-color: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    
    .page-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .total-info {
      font-size: 14px;
      color: var(--gray);
      margin-top: 10px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“Š åŠ¨æ€æŠ¥ä»·è¡¨ç¼–è¾‘å™¨</h1>
    <div class="toolbar">
      <button id="addRowBtn">â• æ·»åŠ è¡Œ</button>
      <button id="batchAddRowsBtn">ğŸ§© ä¸€é”®æ·»åŠ è¡Œ</button>
      <button id="addColumnBtn">â• æ·»åŠ åˆ—</button>
      <button id="bulkDeleteBtn">ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤</button>
      <button id="undoBtn">â†©ï¸ æ’¤é”€</button>
      <button id="exportBtn">ğŸ“¥ å¯¼å‡º CSV</button>
      <button id="importBtn">ğŸ“¤ å¯¼å…¥ CSV</button>
    </div>

    <div class="toolbar">
      <div class="import-options">
        <div class="addon-input-group">
          <label for="addonValueInput">é™„åŠ é‡‘é¢ï¼š</label>
          <input type="number" id="addonValueInput" value="85" min="0" step="1">
        </div>
        <div class="flex-label">
          <input type="checkbox" id="clearBeforeImport" checked>
          <label for="clearBeforeImport">å¯¼å…¥å‰æ¸…ç©ºç°æœ‰æ•°æ®</label>
        </div>
        <div class="flex-label">
          <input type="checkbox" id="importSortAsc" checked>
          <label for="importSortAsc">å¯¼å…¥åå‡åºæ’åˆ—</label>
        </div>
      </div>
    </div>

    <div class="table-container">
      <table id="dataTable">
      <thead id="tableHead">
        <tr>
          <th class="select-all">
            <div class="th-content">
              <input type="checkbox" id="selectAll">
            </div>
          </th>
          <!-- æ‹–æ‹½æ’åºåˆ—å·²ç§»é™¤ -->
          <th onclick="sortTableByColumn(2)" class="sortable serial-number">
            <div class="th-content">
              <span>ç¼–å·</span>
              <span class="sort-indicator" id="sort-indicator-2"></span>
              <input type="hidden" class="col-name" value="ç¼–å·">
            </div>
          </th>
          <th onclick="sortTableByColumn(3)" class="sortable">
            <div class="th-content">
              <span>ç³»ç»Ÿç±»å‹</span>
              <span class="sort-indicator" id="sort-indicator-3"></span>
              <input type="hidden" class="col-name" value="ç³»ç»Ÿç±»å‹">
            </div>
          </th>
          <th onclick="sortTableByColumn(4)" class="sortable">
            <div class="th-content">
              <span>å°ºå¯¸</span>
              <span class="sort-indicator" id="sort-indicator-4"></span>
              <input type="hidden" class="col-name" value="å°ºå¯¸">
            </div>
          </th>
          <th onclick="sortTableByColumn(5)" class="sortable">
            <div class="th-content">
              <span>é…ç½®å‚æ•°</span>
              <span class="sort-indicator" id="sort-indicator-5"></span>
              <input type="hidden" class="col-name" value="é…ç½®å‚æ•°">
            </div>
          </th>
          <th>
            <div class="th-content">
              <span>åŸä»·+85</span>
              <span style="color:#64748b;font-size:11px;white-space:nowrap;">(è‡ªåŠ¨)</span>
              <input type="hidden" class="col-name" value="åŸä»·+85">
            </div>
          </th>
          <th>
            <div class="th-content">
              <span>åŸä»·</span>
              <input type="hidden" class="col-name" value="åŸä»·">
            </div>
          </th>
          <th>
            <div class="th-content">
              <span>æ“ä½œ</span>
            </div>
          </th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <!-- è¡Œæ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
      </tbody>
      </table>
    </div>
    
    <!-- ç¿»é¡µæ§ä»¶ -->
    <div class="pagination-controls">
      <div class="page-info">
        ç¬¬ <span id="currentPage">1</span> é¡µï¼Œå…± <span id="totalPages">1</span> é¡µ
      </div>
      <div class="page-buttons">
        <button class="page-btn" id="prevPage" disabled>ä¸Šä¸€é¡µ</button>
        <button class="page-btn active" id="page1">1</button>
        <button class="page-btn" id="nextPage" disabled>ä¸‹ä¸€é¡µ</button>
      </div>
    </div>
    
    <!-- æ€»æ•°æ®ä¿¡æ¯ -->
    <div class="total-info">
      å…± <span id="totalRows">0</span> æ¡æ•°æ®
    </div>
  </div>

  <input type="file" id="csvFileInput" accept=".csv">

  <!-- æ‰¹é‡æ·»åŠ å°ºå¯¸å¼¹çª— -->
  <div id="batchAddModal" class="modal">
    <div class="modal-bg" id="batchAddBg"></div>
    <div class="modal-content">
      <div class="modal-header">
        <span>æ‰¹é‡æ·»åŠ å°ºå¯¸è¡Œ</span>
        <span class="modal-close" id="batchAddClose">&times;</span>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>ç³»ç»Ÿç±»å‹ï¼š</label>
          <select id="batchSystemType" style="width:100%;padding:8px 10px;border-radius:7px;border:1.5px solid #e5e7eb;font-size:15px;margin-bottom:10px;">
            <option value="">è¯·é€‰æ‹©</option>
            <option value="Android">Android</option>
            <option value="Windows">Windows</option>
          </select>
        </div>
        <div class="form-group">
          <label>é…ç½®å‚æ•°ï¼š</label>
          <input type="text" id="batchConfigParam" placeholder="å¦‚ i7/16G/512G" style="width:100%;padding:8px 10px;border-radius:7px;border:1.5px solid #e5e7eb;font-size:15px;margin-bottom:10px;">
        </div>
        <div class="form-group">
          <label>è¯·é€‰æ‹©è¦æ·»åŠ çš„å°ºå¯¸ï¼š</label>
          <div class="size-select-list" id="batchSizeList"></div>
          <input type="text" id="customSizeInput" placeholder="è‡ªå®šä¹‰å°ºå¯¸ï¼Œå¦‚ 22 æˆ– 23.8" style="width:60%;margin-right:8px;">
          <button type="button" id="addCustomSizeBtn" class="btn-primary" style="padding:6px 12px;font-size:13px;">æ·»åŠ å°ºå¯¸</button>
        </div>
        <div style="margin:10px 0 0 0;">
          <label>å·²é€‰å°ºå¯¸ï¼š</label>
          <div class="selected-size-list" id="selectedSizeList"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" id="batchAddCancel">å–æ¶ˆ</button>
        <button class="btn-primary" id="batchAddConfirm">âœ… æ‰¹é‡æ·»åŠ </button>
      </div>
    </div>
  </div>

  <!-- æ¨¡æ€æ¡† -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span id="modal-title">æ·»åŠ æ–°æŠ¥ä»·è¡Œ</span>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="systemType">ç³»ç»Ÿç±»å‹ *</label>
          <select id="systemType">
            <option value="">è¯·é€‰æ‹©</option>
            <option value="Android">Android</option>
            <option value="Windows">Windows</option>
          </select>
        </div>
        <div class="form-group">
          <label for="sizeSelect">å°ºå¯¸ï¼ˆè‹±å¯¸ï¼‰ *</label>
          <select id="sizeSelect">
            <option value="">è¯·é€‰æ‹©å°ºå¯¸</option>
            <option value="10.1">10.1</option>
            <option value="10.4">10.4</option>
            <option value="12.1">12.1</option>
            <option value="15">15</option>
            <option value="17">17</option>
            <option value="19">19</option>
            <option value="13.3">13.3</option>
            <option value="15.6">15.6</option>
            <option value="18.5">18.5</option>
            <option value="21.5">21.5</option>
          </select>
        </div>
        <div class="form-group">
          <label for="configParam">é…ç½®å‚æ•° *</label>
          <input type="text" id="configParam" placeholder="ä¾‹å¦‚ï¼ši7 / 16GB / 512GB SSD">
        </div>
        <div class="form-group">
          <label for="price">åŸä»·ï¼ˆå…ƒï¼‰ *</label>
          <input type="number" id="price" placeholder="è¯·è¾“å…¥ä»·æ ¼" min="0" step="0.01">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" id="cancelBtn">å–æ¶ˆ</button>
        <button class="btn-primary" id="confirmBtn">âœ… ç¡®è®¤æ·»åŠ </button>
      </div>
    </div>
  </div>

  <script>
          // æ‰¹é‡æ·»åŠ å¼¹çª—æ–°æ§ä»¶å¼•ç”¨
          const batchSystemType = document.getElementById('batchSystemType');
          const batchConfigParam = document.getElementById('batchConfigParam');
        // ========== æ‰¹é‡æ·»åŠ å°ºå¯¸å¼¹çª—ä¼˜åŒ– ==========
        const batchAddModal = document.getElementById('batchAddModal');
        const batchAddClose = document.getElementById('batchAddClose');
        const batchAddCancel = document.getElementById('batchAddCancel');
        const batchAddConfirm = document.getElementById('batchAddConfirm');
        const batchSizeList = document.getElementById('batchSizeList');
        const customSizeInput = document.getElementById('customSizeInput');
        const addCustomSizeBtn = document.getElementById('addCustomSizeBtn');
        const selectedSizeList = document.getElementById('selectedSizeList');
        const batchAddBg = document.getElementById('batchAddBg');

        const DEFAULT_SIZES = ["10.1","10.4","12.1","13.3","15","15.6","17","18.5","19","21.5"];
        let batchSizeOptions = [...DEFAULT_SIZES];
        let selectedSizes = [];

        function openBatchAddModal() {
          renderBatchSizeList();
          renderSelectedSizeList();
          customSizeInput.value = '';
          batchAddModal.style.display = 'flex';
        }
        function closeBatchAddModal() {
          batchAddModal.style.display = 'none';
          selectedSizes = [];
          // æ¸…ç©ºè¡¨å•æ•°æ®
          batchSystemType.value = '';
          batchConfigParam.value = '';
          customSizeInput.value = '';
          renderBatchSizeList();
          renderSelectedSizeList();
        }
        batchAddClose.onclick = closeBatchAddModal;
        batchAddCancel.onclick = closeBatchAddModal;
        batchAddBg.onclick = closeBatchAddModal;

        function renderBatchSizeList() {
          batchSizeList.innerHTML = '';
          batchSizeOptions.forEach(size => {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'size-option-btn' + (selectedSizes.includes(size) ? ' selected' : '');
            btn.textContent = size + ' è‹±å¯¸';
            // é¡ºåºå·
            const idx = selectedSizes.indexOf(size);
            if (idx !== -1) {
              const badge = document.createElement('span');
              badge.className = 'order-badge';
              badge.textContent = idx + 1;
              btn.appendChild(badge);
            }
            btn.onclick = function() {
              if (!selectedSizes.includes(size)) {
                selectedSizes.push(size);
              } else {
                selectedSizes = selectedSizes.filter(s => s !== size);
              }
              renderBatchSizeList();
              renderSelectedSizeList();
            };
            batchSizeList.appendChild(btn);
          });
        }
        function renderSelectedSizeList() {
          selectedSizeList.innerHTML = '';
          selectedSizes.forEach(size => {
            const item = document.createElement('div');
            item.className = 'selected-size-item';
            item.innerHTML = `${size} è‹±å¯¸ <span class="remove-size" title="ç§»é™¤">Ã—</span>`;
            item.querySelector('.remove-size').onclick = function() {
              selectedSizes = selectedSizes.filter(s => s !== size);
              renderBatchSizeList();
              renderSelectedSizeList();
            };
            selectedSizeList.appendChild(item);
          });
        }
        addCustomSizeBtn.onclick = function() {
          const val = customSizeInput.value.trim();
          if (!val) return;
          if (batchSizeOptions.includes(val)) {
            alert('è¯¥å°ºå¯¸å·²å­˜åœ¨ï¼');
            return;
          }
          batchSizeOptions.push(val);
          renderBatchSizeList();
          customSizeInput.value = '';
        };
        batchAddConfirm.onclick = function() {
          if (selectedSizes.length === 0) {
            alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªå°ºå¯¸ï¼');
            return;
          }
          // æ ¡éªŒç³»ç»Ÿç±»å‹
          const sysType = batchSystemType.value;
          if (!sysType) {
            alert('è¯·é€‰æ‹©ç³»ç»Ÿç±»å‹ï¼');
            batchSystemType.focus();
            return;
          }
          const configParam = batchConfigParam.value.trim();
          if (!configParam) {
            alert('è¯·å¡«å†™é…ç½®å‚æ•°ï¼');
            batchConfigParam.focus();
            return;
          }
          saveState();
          const nextSerial = getNextSerialNumber();
          selectedSizes.forEach((size, idx) => {
            allData.push({
              serialNumber: nextSerial + idx,
              systemType: sysType,
              size: size,
              configParam: configParam,
              price: 0,
              computedPrice: 0 + (parseFloat(addonInput.value) || 0)
            });
          });
          renderTable();
          updatePagination();
          // è‡ªåŠ¨è·³è½¬åˆ°æœ€æ–°é¡µ
          currentPage = Math.ceil(allData.length / ROWS_PER_PAGE) || 1;
          renderTable();
          updatePagination();
          closeBatchAddModal();
        };
        document.getElementById('batchAddRowsBtn').onclick = openBatchAddModal;
    /**
     * åŠ¨æ€æŠ¥ä»·è¡¨ç¼–è¾‘å™¨ - ä¸»è¦åŠŸèƒ½æ¨¡å—
     * 
     * åŠŸèƒ½æ¦‚è¿°ï¼š
     * 1. æ•°æ®ç®¡ç†ï¼šæ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤ã€æ‰¹é‡åˆ é™¤æŠ¥ä»·è®°å½•
     * 2. æ’åºåŠŸèƒ½ï¼šæ”¯æŒå¤šåˆ—æ’åºï¼ŒåŒ…æ‹¬å‡åº/é™åºåˆ‡æ¢
     * 3. åˆ†é¡µæ˜¾ç¤ºï¼šæ¯é¡µæ˜¾ç¤º10æ¡è®°å½•ï¼Œæ”¯æŒç¿»é¡µå¯¼èˆª
     * 4. CSVå¯¼å…¥å¯¼å‡ºï¼šæ”¯æŒæ•°æ®çš„æ‰¹é‡å¯¼å…¥å¯¼å‡º
     * 5. æ’¤é”€æ“ä½œï¼šæœ€å¤šä¿å­˜10æ­¥æ“ä½œå†å²
     * 6. åŠ¨æ€åˆ—ç®¡ç†ï¼šæ”¯æŒæ·»åŠ /åˆ é™¤è‡ªå®šä¹‰åˆ—
     * 7. è‡ªåŠ¨è®¡ç®—ï¼šåŸä»·+é™„åŠ å€¼çš„è‡ªåŠ¨è®¡ç®—
     */

    // === å…¨å±€å˜é‡å’Œæ•°æ®å­˜å‚¨ ===
    
    /**
     * å­˜å‚¨æ‰€æœ‰æŠ¥ä»·æ•°æ®çš„æ•°ç»„
     * æ¯ä¸ªå…ƒç´ åŒ…å«ï¼šserialNumber(ç¼–å·), systemType(ç³»ç»Ÿç±»å‹), size(å°ºå¯¸), 
     * configParam(é…ç½®å‚æ•°), price(åŸä»·), computedPrice(è®¡ç®—ä»·æ ¼)
     */
    let allData = [];
    
    /**
     * å½“å‰æ˜¾ç¤ºçš„é¡µç ï¼Œä»1å¼€å§‹è®¡æ•°
     */
    let currentPage = 1;
    
    /**
     * æ¯é¡µæ˜¾ç¤ºçš„è¡Œæ•°å¸¸é‡
     */
    const ROWS_PER_PAGE = 10;
    
    /**
     * å½“å‰åˆ—æ•°é‡ï¼ˆåŠ¨æ€å˜åŒ–ï¼‰
     */
    let colCount = 6;
    
    /**
     * ä»·æ ¼ç›¸å…³åˆ—çš„ç´¢å¼•å¸¸é‡
     * PRICE_COL_INDEX: åŸä»·åˆ—ç´¢å¼•
     * COMPUTED_COL_INDEX: è®¡ç®—ä»·æ ¼åˆ—ç´¢å¼•
     */
    const PRICE_COL_INDEX = 6;
    const COMPUTED_COL_INDEX = 5;
    
    /**
     * åŸºç¡€åˆ—åæ•°ç»„ï¼ŒåŒ…å«ç³»ç»Ÿé»˜è®¤çš„æ‰€æœ‰åˆ—
     * å¯ä»¥åŠ¨æ€æ·»åŠ è‡ªå®šä¹‰åˆ—
     */
    const BASE_COLUMNS = ['ç¼–å·', 'ç³»ç»Ÿç±»å‹', 'å°ºå¯¸', 'é…ç½®å‚æ•°', 'åŸä»·+85', 'åŸä»·'];
    
    /**
     * DOMå…ƒç´ å¼•ç”¨ç¼“å­˜
     */
    const addonInput = document.getElementById('addonValueInput');
    const clearBeforeImportCheckbox = document.getElementById('clearBeforeImport');
    const importSortAscCheckbox = document.getElementById('importSortAsc');

    // === æ’åºçŠ¶æ€ç®¡ç†æ¨¡å— ===
    
    /**
     * æ’åºçŠ¶æ€å¯¹è±¡
     * columnIndex: å½“å‰æ’åºçš„åˆ—ç´¢å¼•ï¼ˆ-1è¡¨ç¤ºæœªæ’åºï¼‰
     * isAscending: æ’åºæ–¹å‘ï¼Œtrueä¸ºå‡åºï¼Œfalseä¸ºé™åº
     */
    let sortState = { columnIndex: -1, isAscending: true };

    // === æ’¤é”€æ“ä½œå†å²æ ˆæ¨¡å— ===
    
    /**
     * æ“ä½œå†å²æ ˆï¼Œç”¨äºå®ç°æ’¤é”€åŠŸèƒ½
     * æœ€å¤šä¿å­˜MAX_HISTORYä¸ªæ“ä½œçŠ¶æ€
     */
    const historyStack = [];
    
    /**
     * æœ€å¤§å†å²è®°å½•æ•°é‡
     */
    const MAX_HISTORY = 10;

    /**
     * ä¿å­˜å½“å‰çŠ¶æ€åˆ°å†å²æ ˆ
     * åŠŸèƒ½ï¼šåœ¨æ‰§è¡Œé‡è¦æ“ä½œå‰ä¿å­˜å½“å‰çš„æ•°æ®çŠ¶æ€ã€é¡µç å’Œæ’åºçŠ¶æ€
     * è¾¹ç•Œæ¡ä»¶ï¼šå½“å†å²æ ˆè¾¾åˆ°æœ€å¤§é•¿åº¦æ—¶ï¼Œåˆ é™¤æœ€æ—©çš„è®°å½•
     */
    function saveState() {
      // åˆ›å»ºå½“å‰çŠ¶æ€çš„æ·±æ‹·è´
      const state = {
        allData: [...allData], // å¤åˆ¶æ•°æ®æ•°ç»„
        currentPage: currentPage, // ä¿å­˜å½“å‰é¡µç 
        sortState: {...sortState} // å¤åˆ¶æ’åºçŠ¶æ€
      };
      
      // å¦‚æœå†å²æ ˆå·²æ»¡ï¼Œç§»é™¤æœ€æ—©çš„è®°å½•
      if (historyStack.length >= MAX_HISTORY) {
        historyStack.shift();
      }
      
      // å°†æ–°çŠ¶æ€å‹å…¥æ ˆé¡¶
      historyStack.push(state);
      
      // æ›´æ–°æ’¤é”€æŒ‰é’®çš„å¯ç”¨çŠ¶æ€
      updateUndoButton();
    }

    /**
     * æ¢å¤ä¸Šä¸€ä¸ªçŠ¶æ€
     * åŠŸèƒ½ï¼šä»å†å²æ ˆä¸­å¼¹å‡ºæœ€è¿‘çš„çŠ¶æ€å¹¶æ¢å¤
     * è¾¹ç•Œæ¡ä»¶ï¼šå¦‚æœå†å²æ ˆä¸ºç©ºï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œ
     */
    function restoreState() {
      if (historyStack.length === 0) return;
      
      // å¼¹å‡ºæœ€è¿‘çš„ä¿å­˜çŠ¶æ€
      const lastState = historyStack.pop();
      
      // æ¢å¤å„ä¸ªçŠ¶æ€
      allData = lastState.allData;
      currentPage = lastState.currentPage;
      sortState = lastState.sortState;
      
      // é‡æ–°æ¸²æŸ“ç•Œé¢
      renderTable();
      updatePagination();
      updateUndoButton();
    }

    /**
     * æ›´æ–°æ’¤é”€æŒ‰é’®çš„å¯ç”¨/ç¦ç”¨çŠ¶æ€
     * åŠŸèƒ½ï¼šæ ¹æ®å†å²æ ˆæ˜¯å¦ä¸ºç©ºæ¥æ§åˆ¶æŒ‰é’®çš„å¯ç”¨æ€§
     */
    function updateUndoButton() {
      const undoBtn = document.getElementById('undoBtn');
      // å¦‚æœå†å²æ ˆä¸ä¸ºç©ºï¼Œå¯ç”¨æŒ‰é’®ï¼›å¦åˆ™ç¦ç”¨
      undoBtn.classList.toggle('enabled', historyStack.length > 0);
    }

    // åˆå§‹åŒ–æ—¶ä¿å­˜åˆå§‹çŠ¶æ€ï¼Œå»¶è¿Ÿ100msç¡®ä¿DOMå®Œå…¨åŠ è½½
    setTimeout(() => saveState(), 100);

    // === æ‰¹é‡åˆ é™¤çŠ¶æ€ç®¡ç†æ¨¡å— ===
    
    /**
     * æ›´æ–°æ‰¹é‡åˆ é™¤æŒ‰é’®çš„çŠ¶æ€
     * åŠŸèƒ½ï¼šæ ¹æ®é€‰ä¸­çš„è¡Œæ•°æ¥å¯ç”¨æˆ–ç¦ç”¨æ‰¹é‡åˆ é™¤æŒ‰é’®
     * ç®—æ³•ï¼šç»Ÿè®¡å½“å‰é¡µé¢é€‰ä¸­çš„å¤é€‰æ¡†æ•°é‡
     */
    function updateBulkDeleteButton() {
      // è·å–å½“å‰é¡µé¢é€‰ä¸­çš„è¡Œå¤é€‰æ¡†æ•°é‡
      const checkedCount = document.querySelectorAll('#tableBody .row-checkbox:checked').length;
      const bulkBtn = document.getElementById('bulkDeleteBtn');
      // å¦‚æœæœ‰é€‰ä¸­è¡Œï¼Œå¯ç”¨æŒ‰é’®ï¼›å¦åˆ™ç¦ç”¨
      bulkBtn.classList.toggle('enabled', checkedCount > 0);
    }

    // === è¡¨æ ¼æ’åºé€»è¾‘æ¨¡å— ===
    
    /**
     * æŒ‰æŒ‡å®šåˆ—å¯¹è¡¨æ ¼è¿›è¡Œæ’åº
     * @param {number} columnIndex - è¦æ’åºçš„åˆ—ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰
     * @param {boolean|null} isAscending - æ’åºæ–¹å‘ï¼Œnullè¡¨ç¤ºè‡ªåŠ¨åˆ‡æ¢
     * 
     * åŠŸèƒ½è¯´æ˜ï¼š
     * 1. æ›´æ–°æ’åºçŠ¶æ€å’ŒUIæŒ‡ç¤ºå™¨
     * 2. å¯¹allDataæ•°ç»„è¿›è¡Œæ’åº
     * 3. é‡æ–°æ¸²æŸ“è¡¨æ ¼å’Œåˆ†é¡µ
     * 
     * æ’åºç®—æ³•ï¼š
     * - ä¼˜å…ˆå°è¯•æ•°å­—æ’åºï¼ˆé€‚ç”¨äºç¼–å·ã€å°ºå¯¸ã€ä»·æ ¼åˆ—ï¼‰
     * - é™çº§ä¸ºå­—ç¬¦ä¸²æ’åºï¼ˆé€‚ç”¨äºæ–‡æœ¬åˆ—ï¼‰
     * - æ”¯æŒå‡åº/é™åºåˆ‡æ¢
     */
    function sortTableByColumn(columnIndex, isAscending = null) {
      // === ç¬¬ä¸€æ­¥ï¼šæ›´æ–°æ’åºçŠ¶æ€ ===
      if (sortState.columnIndex === columnIndex) {
        // å¦‚æœæ˜¯åŒä¸€åˆ—ï¼Œåˆ‡æ¢æ’åºæ–¹å‘æˆ–ä½¿ç”¨æŒ‡å®šæ–¹å‘
        if (isAscending !== null) {
          sortState.isAscending = isAscending;
        } else {
          sortState.isAscending = !sortState.isAscending;
        }
      } else {
        // å¦‚æœæ˜¯ä¸åŒåˆ—ï¼Œè®¾ç½®æ–°åˆ—å¹¶é»˜è®¤å‡åº
        sortState.columnIndex = columnIndex;
        sortState.isAscending = (isAscending !== null) ? isAscending : true;
      }

      // === ç¬¬äºŒæ­¥ï¼šæ›´æ–°UIæŒ‡ç¤ºå™¨ ===
      // æ¸…é™¤æ‰€æœ‰æ’åºæŒ‡ç¤ºå™¨
      document.querySelectorAll('.sort-indicator').forEach(el => {
        el.textContent = '';
        el.classList.remove('active');
      });
      
      // è®¾ç½®å½“å‰åˆ—çš„æ’åºæŒ‡ç¤ºå™¨
      const indicator = document.getElementById(`sort-indicator-${columnIndex}`);
      indicator.textContent = sortState.isAscending ? 'â†‘' : 'â†“';
      indicator.classList.add('active');

      // === ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡Œæ•°æ®æ’åº ===
      allData.sort((a, b) => {
        let aText, bText;
        
        // æ ¹æ®åˆ—ç´¢å¼•è·å–å¯¹åº”çš„æ¯”è¾ƒå€¼
        if (columnIndex === 2) { // ç¼–å·åˆ—
          aText = a.serialNumber.toString();
          bText = b.serialNumber.toString();
        } else if (columnIndex === 3) { // ç³»ç»Ÿç±»å‹
          aText = a.systemType;
          bText = b.systemType;
        } else if (columnIndex === 4) { // å°ºå¯¸
          aText = a.size;
          bText = b.size;
        } else if (columnIndex === 5) { // é…ç½®å‚æ•°
          aText = a.configParam;
          bText = b.configParam;
        } else if (columnIndex === 7) { // åŸä»·
          aText = a.price.toString();
          bText = b.price.toString();
        } else {
          return 0; // å…¶ä»–åˆ—ä¸å‚ä¸æ’åº
        }

        // === ç¬¬å››æ­¥ï¼šæ™ºèƒ½æ’åºç®—æ³• ===
        // å°è¯•è½¬æ¢ä¸ºæ•°å­—è¿›è¡Œæ’åºï¼ˆé€‚ç”¨äºç¼–å·ã€å°ºå¯¸ã€ä»·æ ¼åˆ—ï¼‰
        const aNum = parseFloat(aText);
        const bNum = parseFloat(bText);

        let comparison = 0;
        if (!isNaN(aNum) && !isNaN(bNum)) {
          // æ•°å­—æ¯”è¾ƒï¼šç›´æ¥ç›¸å‡å¾—åˆ°æ­£è´Ÿå€¼
          comparison = aNum - bNum;
        } else {
          // å­—ç¬¦ä¸²æ¯”è¾ƒï¼šä½¿ç”¨æœ¬åœ°åŒ–å­—ç¬¦ä¸²æ¯”è¾ƒ
          comparison = aText.localeCompare(bText);
        }

        // æ ¹æ®æ’åºæ–¹å‘è¿”å›æ¯”è¾ƒç»“æœ
        return sortState.isAscending ? comparison : -comparison;
      });

      // === ç¬¬äº”æ­¥ï¼šé‡æ–°æ¸²æŸ“ç•Œé¢ ===
      renderTable();
      updatePagination();
    }

    // === ç¼–å·ç”Ÿæˆæ¨¡å— ===
    
    /**
     * è·å–ä¸‹ä¸€ä¸ªå¯ç”¨çš„ç¼–å·
     * åŠŸèƒ½ï¼šåœ¨ç°æœ‰æ•°æ®ä¸­æ‰¾åˆ°æœ€å¤§çš„ç¼–å·ï¼Œç„¶åè¿”å›+1çš„å€¼
     * è¾¹ç•Œæ¡ä»¶ï¼šå¦‚æœæ•°æ®ä¸ºç©ºï¼Œè¿”å›1
     * ç®—æ³•ï¼šéå†æ‰€æœ‰æ•°æ®é¡¹ï¼Œæ‰¾åˆ°æœ€å¤§çš„serialNumberå€¼
     * @returns {number} ä¸‹ä¸€ä¸ªå¯ç”¨çš„ç¼–å·
     */
    function getNextSerialNumber() {
      if (allData.length === 0) return 1;
      
      let maxNum = 0;
      // éå†æ‰€æœ‰æ•°æ®ï¼Œæ‰¾åˆ°æœ€å¤§ç¼–å·
      allData.forEach(item => {
        if (item.serialNumber > maxNum) maxNum = item.serialNumber;
      });
      
      return maxNum + 1;
    }

    // === æ¨¡æ€æ¡†è¡¨å•ç®¡ç†æ¨¡å— ===
    
    /**
     * DOMå…ƒç´ å¼•ç”¨ç¼“å­˜
     * ç¼“å­˜å¸¸ç”¨çš„DOMå…ƒç´ ä»¥æé«˜æ€§èƒ½
     */
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modal-title');
    // æ”¯æŒå¤šä¸ªå…³é—­æŒ‰é’®
    const modalCloseBtns = document.querySelectorAll('#modal .modal-close');
    const cancelBtn = document.getElementById('cancelBtn');
    const confirmBtn = document.getElementById('confirmBtn');
    const csvFileInput = document.getElementById('csvFileInput');

    /**
     * è¡¨å•è¾“å…¥å…ƒç´ å¼•ç”¨
     */
    const systemTypeEl = document.getElementById('systemType');
    const sizeSelectEl = document.getElementById('sizeSelect');
    const configParamEl = document.getElementById('configParam');
    const priceEl = document.getElementById('price');

    /**
     * å½“å‰ç¼–è¾‘çš„è¡Œå¯¹è±¡ï¼Œnullè¡¨ç¤ºæ–°å¢æ¨¡å¼
     */
    let currentEditRow = null;

    /**
     * æ¸…é™¤è¡¨å•å…ƒç´ çš„é”™è¯¯çŠ¶æ€æ ·å¼
     * @param {HTMLElement} el - è¦æ¸…é™¤é”™è¯¯çš„DOMå…ƒç´ 
     */
    function clearError(el) { 
      el.classList.remove('error'); 
    }
    
    /**
     * ä¸ºè¡¨å•å…ƒç´ æ·»åŠ é”™è¯¯çŠ¶æ€æ ·å¼
     * @param {HTMLElement} el - è¦æ·»åŠ é”™è¯¯çš„DOMå…ƒç´ 
     */
    function showError(el) { 
      el.classList.add('error'); 
    }

    /**
     * éªŒè¯è¡¨å•è¾“å…¥çš„å®Œæ•´æ€§
     * åŠŸèƒ½ï¼šæ£€æŸ¥æ‰€æœ‰å¿…å¡«å­—æ®µæ˜¯å¦å·²å¡«å†™ä¸”æ ¼å¼æ­£ç¡®
     * éªŒè¯è§„åˆ™ï¼š
     * 1. ç³»ç»Ÿç±»å‹ï¼šä¸èƒ½ä¸ºç©º
     * 2. å°ºå¯¸ï¼šä¸èƒ½ä¸ºç©º
     * 3. é…ç½®å‚æ•°ï¼šä¸èƒ½ä¸ºç©ºæˆ–ä»…åŒ…å«ç©ºç™½å­—ç¬¦
     * 4. ä»·æ ¼ï¼šå¿…é¡»ä¸ºæœ‰æ•ˆæ•°å­—
     * 
     * @returns {boolean} éªŒè¯æ˜¯å¦é€šè¿‡
     */
    function validateForm() {
      let valid = true;
      
      // é¦–å…ˆæ¸…é™¤æ‰€æœ‰å­—æ®µçš„é”™è¯¯çŠ¶æ€
      [systemTypeEl, sizeSelectEl, configParamEl, priceEl].forEach(clearError);

      // é€ä¸ªéªŒè¯å¿…å¡«å­—æ®µ
      if (!systemTypeEl.value) { 
        showError(systemTypeEl); 
        valid = false; 
      }
      
      if (!sizeSelectEl.value) { 
        showError(sizeSelectEl); 
        valid = false; 
      }
      
      if (!configParamEl.value.trim()) { 
        showError(configParamEl); 
        valid = false; 
      }
      
      if (!priceEl.value || isNaN(parseFloat(priceEl.value))) { 
        showError(priceEl); 
        valid = false; 
      }

      // å¦‚æœéªŒè¯å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯æç¤ºå¹¶èšç„¦åˆ°ç¬¬ä¸€ä¸ªé”™è¯¯å­—æ®µ
      if (!valid) {
        alert('è¯·å¡«å†™æ‰€æœ‰å¸¦ * çš„å¿…å¡«é¡¹ï¼');
        
        // æŒ‰ä¼˜å…ˆçº§é¡ºåºèšç„¦åˆ°ç¬¬ä¸€ä¸ªç©ºå­—æ®µ
        if (!systemTypeEl.value) systemTypeEl.focus();
        else if (!sizeSelectEl.value) sizeSelectEl.focus();
        else if (!configParamEl.value.trim()) configParamEl.focus();
        else priceEl.focus();
      }
      
      return valid;
    }

    /**
     * é‡ç½®æ¨¡æ€æ¡†è¡¨å•åˆ°åˆå§‹çŠ¶æ€
     * åŠŸèƒ½ï¼šæ¸…ç©ºæ‰€æœ‰è¾“å…¥å­—æ®µï¼Œæ¸…é™¤é”™è¯¯çŠ¶æ€ï¼Œé‡ç½®ä¸ºæ–°å¢æ¨¡å¼
     */
    function resetModalForm() {
      // æ¸…ç©ºæ‰€æœ‰è¾“å…¥å­—æ®µ
      systemTypeEl.value = '';
      sizeSelectEl.value = '';
      configParamEl.value = '';
      priceEl.value = '';
      
      // é‡ç½®ç¼–è¾‘çŠ¶æ€
      currentEditRow = null;
      
      // æ¢å¤é»˜è®¤UIæ–‡æœ¬
      modalTitle.textContent = 'æ·»åŠ æ–°æŠ¥ä»·è¡Œ';
      confirmBtn.textContent = 'âœ… ç¡®è®¤æ·»åŠ ';
      
      // æ¸…é™¤æ‰€æœ‰å­—æ®µçš„é”™è¯¯çŠ¶æ€
      [systemTypeEl, sizeSelectEl, configParamEl, priceEl].forEach(clearError);
    }

    /**
     * æ‰“å¼€æ–°å¢æ¨¡å¼çš„æ¨¡æ€æ¡†
     * åŠŸèƒ½ï¼šé‡ç½®è¡¨å•å¹¶æ˜¾ç¤ºæ¨¡æ€æ¡†ï¼Œç”¨äºæ·»åŠ æ–°çš„æŠ¥ä»·è®°å½•
     */
    function openAddModal() {
      resetModalForm();
      modal.style.display = 'flex';
    }

    /**
     * æ‰“å¼€ç¼–è¾‘æ¨¡å¼çš„æ¨¡æ€æ¡†
     * @param {HTMLElement} row - è¦ç¼–è¾‘çš„è¡Œå…ƒç´ 
     * 
     * åŠŸèƒ½ï¼šå°†é€‰ä¸­è¡Œçš„æ•°æ®å¡«å……åˆ°è¡¨å•ä¸­ï¼Œåˆ‡æ¢ä¸ºç¼–è¾‘æ¨¡å¼
     * ç®—æ³•ï¼š
     * 1. ä»è¡Œçš„data-indexå±æ€§è·å–æ•°æ®ç´¢å¼•
     * 2. ä»allDataæ•°ç»„ä¸­è·å–å¯¹åº”çš„æ•°æ®
     * 3. å°†æ•°æ®å¡«å……åˆ°è¡¨å•å­—æ®µ
     * 4. æ›´æ–°UIä¸ºç¼–è¾‘æ¨¡å¼
     */
    function openEditModal(row) {
      // è·å–å½“å‰è¡Œçš„æ•°æ®ç´¢å¼•
      const rowIndex = parseInt(row.dataset.index);
      const rowData = allData[rowIndex];
      
      // é‡ç½®è¡¨å•å¹¶è®¾ç½®ä¸ºç¼–è¾‘æ¨¡å¼
      resetModalForm();
      currentEditRow = row;
      modalTitle.textContent = 'âœï¸ ç¼–è¾‘æŠ¥ä»·è¡Œ';
      confirmBtn.textContent = 'ğŸ’¾ ä¿å­˜ä¿®æ”¹';

      // å¡«å……è¡¨å•æ•°æ®
      systemTypeEl.value = rowData.systemType;
      sizeSelectEl.value = rowData.size;
      configParamEl.value = rowData.configParam;
      priceEl.value = rowData.price;

      // æ˜¾ç¤ºæ¨¡æ€æ¡†
      modal.style.display = 'flex';
    }

    /**
     * å…³é—­æ¨¡æ€æ¡†
     * åŠŸèƒ½ï¼šéšè—æ¨¡æ€æ¡†å¹¶é‡ç½®è¡¨å•çŠ¶æ€
     */
    function closeModalFn() {
      modal.style.display = 'none';
      resetModalForm();
    }

    /**
     * å¤„ç†è¡¨å•ç¡®è®¤æäº¤
     * åŠŸèƒ½ï¼šæ ¹æ®å½“å‰æ¨¡å¼ï¼ˆæ–°å¢/ç¼–è¾‘ï¼‰å¤„ç†è¡¨å•æ•°æ®
     * ç®—æ³•æµç¨‹ï¼š
     * 1. éªŒè¯è¡¨å•æ•°æ®
     * 2. ä¿å­˜å½“å‰çŠ¶æ€ï¼ˆç”¨äºæ’¤é”€ï¼‰
     * 3. æ ¹æ®æ¨¡å¼æ‰§è¡Œæ–°å¢æˆ–æ›´æ–°æ“ä½œ
     * 4. è‡ªåŠ¨è®¡ç®—é™„åŠ ä»·æ ¼
     * 5. é‡æ–°æ’åºå’Œæ¸²æŸ“è¡¨æ ¼
     * 6. æ–°å¢æ¨¡å¼ä¸‹è‡ªåŠ¨è·³è½¬åˆ°æ–°æ•°æ®æ‰€åœ¨é¡µé¢
     */
    function handleConfirm() {
      // ç¬¬ä¸€æ­¥ï¼šéªŒè¯è¡¨å•
      if (!validateForm()) return;

      // ç¬¬äºŒæ­¥ï¼šæå–è¡¨å•æ•°æ®
      const systemType = systemTypeEl.value;
      const size = sizeSelectEl.value;
      const configParam = configParamEl.value.trim();
      const price = parseFloat(priceEl.value);

      // ç¬¬ä¸‰æ­¥ï¼šä¿å­˜çŠ¶æ€ï¼ˆç”¨äºæ’¤é”€ï¼‰
      saveState();

      let newSerialNumber;
      
      // ç¬¬å››æ­¥ï¼šæ ¹æ®æ¨¡å¼å¤„ç†æ•°æ®
      if (currentEditRow) {
        // ç¼–è¾‘æ¨¡å¼ï¼šæ›´æ–°ç°æœ‰æ•°æ®
        const rowIndex = parseInt(currentEditRow.dataset.index);
        allData[rowIndex] = {
          serialNumber: allData[rowIndex].serialNumber, // ä¿æŒåŸç¼–å·ä¸å˜
          systemType,
          size,
          configParam,
          price,
          computedPrice: price + (parseFloat(addonInput.value) || 0) // è‡ªåŠ¨è®¡ç®—é™„åŠ ä»·æ ¼
        };
      } else {
        // æ–°å¢æ¨¡å¼ï¼šåˆ›å»ºæ–°æ•°æ®
        newSerialNumber = getNextSerialNumber(); // è·å–æ–°ç¼–å·
        allData.push({
          serialNumber: newSerialNumber,
          systemType,
          size,
          configParam,
          price,
          computedPrice: price + (parseFloat(addonInput.value) || 0) // è‡ªåŠ¨è®¡ç®—é™„åŠ ä»·æ ¼
        });
      }

      // ç¬¬äº”æ­¥ï¼šé‡æ–°æ’åºå’Œæ¸²æŸ“
      // å¦‚æœå½“å‰ä¸æ˜¯æŒ‰ç¼–å·æ’åºï¼Œåˆ™åˆ‡æ¢åˆ°ç¼–å·æ’åº
      if (sortState.columnIndex !== 2) {
        sortTableByColumn(2);
      } else {
        // å¦åˆ™ç›´æ¥é‡æ–°æ¸²æŸ“
        renderTable();
        updatePagination();
      }

      // ç¬¬å…­æ­¥ï¼šæ–°å¢æ¨¡å¼ä¸‹è‡ªåŠ¨è·³è½¬åˆ°æ–°æ•°æ®æ‰€åœ¨é¡µé¢
      if (!currentEditRow && newSerialNumber) {
        // æ ¹æ®æ–°æ•°æ®çš„ç¼–å·æ‰¾åˆ°å…¶åœ¨æ’åºåæ•°ç»„ä¸­çš„ä½ç½®
        const newDataIndex = allData.findIndex(item => item.serialNumber === newSerialNumber);
        if (newDataIndex !== -1) {
          // è®¡ç®—è¯¥æ•°æ®æ‰€åœ¨çš„é¡µç ï¼ˆé¡µç ä»1å¼€å§‹ï¼‰
          const targetPage = Math.floor(newDataIndex / ROWS_PER_PAGE) + 1;
          // å¦‚æœä¸åœ¨å½“å‰é¡µï¼Œåˆ™è·³è½¬åˆ°ç›®æ ‡é¡µ
          if (targetPage !== currentPage) {
            goToPage(targetPage);
          }
        }
      }

      // ç¬¬ä¸ƒæ­¥ï¼šå…³é—­æ¨¡æ€æ¡†
      closeModalFn();
    }

    /**
     * æ›´æ–°æ‰€æœ‰è®¡ç®—ä»·æ ¼å­—æ®µ
     * åŠŸèƒ½ï¼šå½“é™„åŠ é‡‘é¢æ”¹å˜æ—¶ï¼Œé‡æ–°è®¡ç®—æ‰€æœ‰è®°å½•çš„"åŸä»·+é™„åŠ å€¼"
     * ç®—æ³•ï¼šéå†æ‰€æœ‰æ•°æ®ï¼Œä¸ºæ¯é¡¹é‡æ–°è®¡ç®—computedPrice
     */
    function updateComputedCells() {
      const addon = parseFloat(addonInput.value) || 0;
      
      // éå†æ‰€æœ‰æ•°æ®é¡¹ï¼Œæ›´æ–°è®¡ç®—ä»·æ ¼
      allData.forEach(item => {
        item.computedPrice = item.price + addon;
      });
      
      // é‡æ–°æ¸²æŸ“è¡¨æ ¼ä»¥æ˜¾ç¤ºæ›´æ–°åçš„ä»·æ ¼
      renderTable();
    }

    // === åŠ¨æ€åˆ—ç®¡ç†æ¨¡å— ===
    
    /**
     * æ·»åŠ æ–°çš„è‡ªå®šä¹‰åˆ—
     * @param {string} colName - æ–°åˆ—çš„åç§°
     * 
     * åŠŸèƒ½ï¼šå‘è¡¨æ ¼ä¸­æ·»åŠ è‡ªå®šä¹‰åˆ—ï¼Œæ”¯æŒæ’åºå’Œåˆ é™¤
     * ç®—æ³•æµç¨‹ï¼š
     * 1. æ£€æŸ¥åˆ—åæ˜¯å¦é‡å¤
     * 2. æ›´æ–°BASE_COLUMNSæ•°ç»„
     * 3. åˆ›å»ºè¡¨å¤´DOMå…ƒç´ 
     * 4. ä¸ºæ‰€æœ‰ç°æœ‰æ•°æ®æ·»åŠ æ–°å­—æ®µ
     * 5. é‡æ–°æ¸²æŸ“è¡¨æ ¼
     * 
     * è¾¹ç•Œæ¡ä»¶ï¼š
     * - åˆ—åä¸èƒ½é‡å¤
     * - æ–°åˆ—é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²
     */
    function addColumn(colName) {
      // ç¬¬ä¸€æ­¥ï¼šä¿å­˜çŠ¶æ€ï¼ˆç”¨äºæ’¤é”€ï¼‰
      saveState();
      
      // ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥åˆ—åå”¯ä¸€æ€§
      const existingColNames = Array.from(document.querySelectorAll('#tableHead th .col-name')).map(input => input.value);
      if (existingColNames.includes(colName)) {
        alert(`åˆ—å "${colName}" å·²å­˜åœ¨ï¼`);
        return;
      }
      
      // ç¬¬ä¸‰æ­¥ï¼šæ›´æ–°åˆ—åæ•°ç»„
      BASE_COLUMNS.push(colName);
      
      // ç¬¬å››æ­¥ï¼šåˆ›å»ºå¹¶æ’å…¥è¡¨å¤´
      const headerRow = document.querySelector('#tableHead tr');
      const newHeaderCell = document.createElement('th');
      newHeaderCell.className = 'sortable custom-column';
      newHeaderCell.onclick = () => sortTableByColumn(BASE_COLUMNS.length + 1);
      newHeaderCell.innerHTML = `
        <div class="th-content">
          <span>${colName}</span>
          <span class="sort-indicator" id="sort-indicator-${BASE_COLUMNS.length + 1}"></span>
          <input type="hidden" class="col-name" value="${colName}">
          <div class="col-actions">
            <button class="col-btn delete-col-btn" onclick="deleteColumn('${colName}', ${BASE_COLUMNS.length + 1})">-</button>
          </div>
        </div>
      `;
      // åœ¨æ“ä½œåˆ—ä¹‹å‰æ’å…¥æ–°åˆ—
      headerRow.insertBefore(newHeaderCell, headerRow.lastElementChild);
      
      // ç¬¬äº”æ­¥ï¼šä¸ºæ‰€æœ‰æ•°æ®é¡¹æ·»åŠ æ–°å­—æ®µ
      allData.forEach(item => {
        if (!item.hasOwnProperty(colName)) {
          item[colName] = ''; // é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²
        }
      });
      
      // ç¬¬å…­æ­¥ï¼šé‡æ–°æ¸²æŸ“ç•Œé¢
      renderTable();
      updatePagination();
    }

    /**
     * åˆ é™¤æŒ‡å®šåˆ—
     * @param {string} colName - è¦åˆ é™¤çš„åˆ—å
     * @param {number} colIndex - åˆ—çš„ç´¢å¼•ä½ç½®
     * 
     * åŠŸèƒ½ï¼šä»è¡¨æ ¼ä¸­å®Œå…¨ç§»é™¤æŒ‡å®šåˆ—ï¼ŒåŒ…æ‹¬æ•°æ®å’ŒDOM
     * ç®—æ³•æµç¨‹ï¼š
     * 1. ç”¨æˆ·ç¡®è®¤åˆ é™¤æ“ä½œ
     * 2. ä¿å­˜çŠ¶æ€ï¼ˆç”¨äºæ’¤é”€ï¼‰
     * 3. ä»BASE_COLUMNSæ•°ç»„ä¸­ç§»é™¤åˆ—å
     * 4. ä»æ‰€æœ‰æ•°æ®é¡¹ä¸­åˆ é™¤å¯¹åº”å­—æ®µ
     * 5. ä»DOMä¸­ç§»é™¤è¡¨å¤´å’Œæ‰€æœ‰è¡Œä¸­çš„å•å…ƒæ ¼
     * 6. æ›´æ–°æ’åºæŒ‡ç¤ºå™¨çš„IDå’Œäº‹ä»¶ç»‘å®š
     * 
     * è¾¹ç•Œæ¡ä»¶ï¼š
     * - éœ€è¦ç”¨æˆ·ç¡®è®¤æ‰èƒ½åˆ é™¤
     * - åˆ é™¤åéœ€è¦é‡æ–°ç»‘å®šæ’åºäº‹ä»¶
     */
    function deleteColumn(colName, colIndex) {
      // ç¬¬ä¸€æ­¥ï¼šç”¨æˆ·ç¡®è®¤
      if (!confirm(`ç¡®å®šè¦åˆ é™¤åˆ— "${colName}" å—ï¼Ÿ`)) return;
      
      // ç¬¬äºŒæ­¥ï¼šä¿å­˜çŠ¶æ€ï¼ˆç”¨äºæ’¤é”€ï¼‰
      saveState();
      
      // ç¬¬ä¸‰æ­¥ï¼šä»åˆ—åæ•°ç»„ä¸­ç§»é™¤
      const colIndexInBase = BASE_COLUMNS.indexOf(colName);
      if (colIndexInBase !== -1) {
        BASE_COLUMNS.splice(colIndexInBase, 1);
      }
      
      // ç¬¬å››æ­¥ï¼šä»æ‰€æœ‰æ•°æ®é¡¹ä¸­ç§»é™¤å­—æ®µ
      allData.forEach(item => {
        delete item[colName];
      });
      
      // ç¬¬äº”æ­¥ï¼šä»DOMä¸­ç§»é™¤è¡¨å¤´
      const headerRow = document.querySelector('#tableHead tr');
      const headerCells = headerRow.querySelectorAll('th');
      if (headerCells[colIndex]) {
        headerRow.removeChild(headerCells[colIndex]);
      }
      
      // ç¬¬å…­æ­¥ï¼šä»æ‰€æœ‰è¡Œä¸­ç§»é™¤å¯¹åº”å•å…ƒæ ¼
      const rows = document.querySelectorAll('#tableBody tr');
      rows.forEach(row => {
        const cells = row.querySelectorAll('td, th');
        if (cells[colIndex]) {
          row.removeChild(cells[colIndex]);
        }
      });
      
      // ç¬¬ä¸ƒæ­¥ï¼šæ›´æ–°æ’åºæŒ‡ç¤ºå™¨ID
      document.querySelectorAll('.sort-indicator').forEach((el, idx) => {
        if (idx >= colIndex) {
          el.id = `sort-indicator-${idx}`;
        }
      });
      
      // ç¬¬å…«æ­¥ï¼šé‡æ–°ç»‘å®šæ’åºäº‹ä»¶
      const sortableHeaders = document.querySelectorAll('#tableHead th.sortable');
      sortableHeaders.forEach((header, index) => {
        header.onclick = () => sortTableByColumn(index + 1);
      });
    }

    // === CSVå¯¼å…¥å¯¼å‡ºæ¨¡å— ===
    
    /**
     * å¯¼å‡ºæ•°æ®ä¸ºCSVæ–‡ä»¶
     * åŠŸèƒ½ï¼šå°†å½“å‰è¡¨æ ¼æ•°æ®å¯¼å‡ºä¸ºCSVæ ¼å¼æ–‡ä»¶
     * ç®—æ³•æµç¨‹ï¼š
     * 1. æ„å»ºè¡¨å¤´è¡Œ
     * 2. éå†æ•°æ®æ„å»ºå†…å®¹è¡Œ
     * 3. å¤„ç†ç‰¹æ®Šå­—ç¬¦ï¼ˆé€—å·ã€å¼•å·ã€æ¢è¡Œç¬¦ï¼‰
     * 4. ç”ŸæˆBlobå¯¹è±¡å¹¶ä¸‹è½½
     * 
     * ç‰¹æ®Šå¤„ç†ï¼š
     * - æ•°å­—å­—æ®µä¿ç•™ä¸¤ä½å°æ•°
     * - åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„å­—æ®µç”¨åŒå¼•å·åŒ…å›´
     * - æ–‡ä»¶ååŒ…å«å½“å‰æ—¥æœŸ
     */
    function exportToCSV() {
      // ç¬¬ä¸€æ­¥ï¼šæ„å»ºè¡¨å¤´
      const headers = [...BASE_COLUMNS];
      
      // ç¬¬äºŒæ­¥ï¼šæ„å»ºæ•°æ®è¡Œ
      const rows = allData.map(item => {
        const row = [];
        
        // æ ¹æ®åˆ—åæå–å¯¹åº”æ•°æ®
        BASE_COLUMNS.forEach(colName => {
          if (colName === 'ç¼–å·') {
            row.push(item.serialNumber);
          } else if (colName === 'ç³»ç»Ÿç±»å‹') {
            row.push(item.systemType);
          } else if (colName === 'å°ºå¯¸') {
            row.push(item.size);
          } else if (colName === 'é…ç½®å‚æ•°') {
            row.push(item.configParam);
          } else if (colName === 'åŸä»·+85') {
            row.push(item.computedPrice.toFixed(2)); // ä¿ç•™ä¸¤ä½å°æ•°
          } else if (colName === 'åŸä»·') {
            row.push(item.price.toFixed(2)); // ä¿ç•™ä¸¤ä½å°æ•°
          } else {
            // è‡ªå®šä¹‰åˆ—ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨ç©ºå­—ç¬¦ä¸²
            row.push(item[colName] || '');
          }
        });
        
        // ç¬¬ä¸‰æ­¥ï¼šå¤„ç†CSVç‰¹æ®Šå­—ç¬¦
        return row.map(field => {
          const fieldStr = field.toString();
          // å¦‚æœå­—æ®µåŒ…å«é€—å·ã€å¼•å·æˆ–æ¢è¡Œç¬¦ï¼Œéœ€è¦ç”¨åŒå¼•å·åŒ…å›´
          if (fieldStr.includes(',') || fieldStr.includes('"') || fieldStr.includes('\n')) {
            // å°†å­—æ®µå†…çš„åŒå¼•å·è½¬ä¹‰ä¸ºä¸¤ä¸ªåŒå¼•å·
            return `"${fieldStr.replace(/"/g, '""')}"`;
          }
          return field;
        }).join(',');
      });
      
      // ç¬¬å››æ­¥ï¼šç”ŸæˆCSVå†…å®¹
      const csvContent = [headers.join(','), ...rows].join('\n');
      
      // ç¬¬äº”æ­¥ï¼šåˆ›å»ºä¸‹è½½é“¾æ¥
      const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      
      // ç”ŸæˆåŒ…å«æ—¥æœŸçš„æ–‡ä»¶å
      const now = new Date().toISOString().slice(0,10).replace(/-/g, '');
      a.download = `æŠ¥ä»·è¡¨_${now}.csv`;
      
      // ç¬¬å…­æ­¥ï¼šè§¦å‘ä¸‹è½½
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url); // é‡Šæ”¾å†…å­˜
    }

    /**
     * è§£æCSVæ–‡æœ¬å†…å®¹
     * @param {string} text - CSVæ ¼å¼çš„æ–‡æœ¬å†…å®¹
     * @returns {Object} åŒ…å«headerså’Œdataçš„è§£æç»“æœ
     * 
     * åŠŸèƒ½ï¼šå°†CSVæ–‡æœ¬è§£æä¸ºè¡¨å¤´å’Œæ•°æ®æ•°ç»„
     * ç®—æ³•ï¼šçŠ¶æ€æœºè§£æï¼Œå¤„ç†å¼•å·åŒ…å›´çš„å­—æ®µ
     * 
     * è§£æè§„åˆ™ï¼š
     * 1. æ”¯æŒé€—å·åˆ†éš”
     * 2. æ”¯æŒåŒå¼•å·åŒ…å›´å­—æ®µ
     * 3. æ”¯æŒå­—æ®µå†…åŒ…å«é€—å·å’Œå¼•å·
     * 4. è‡ªåŠ¨è·³è¿‡ç©ºè¡Œ
     */
    function parseCSV(text) {
      // ç¬¬ä¸€æ­¥ï¼šåˆ†å‰²è¡Œå¹¶è¿‡æ»¤ç©ºè¡Œ
      const lines = text.split(/\r\n|\n/).filter(line => line.trim() !== '');
      if (lines.length === 0) return { headers: [], data: [] };
      
      // ç¬¬äºŒæ­¥ï¼šè§£æè¡¨å¤´
      const headers = lines[0].split(',').map(h => h.trim().replace(/^"(.*)"$/, '$1'));
      
      // ç¬¬ä¸‰æ­¥ï¼šè§£ææ•°æ®è¡Œ
      const data = [];
      for (let i = 1; i < lines.length; i++) {
        const line = lines[i];
        const row = [];
        let inQuotes = false; // æ˜¯å¦åœ¨å¼•å·å†…
        let field = ''; // å½“å‰å­—æ®µå†…å®¹
        
        // ç¬¬å››æ­¥ï¼šé€å­—ç¬¦è§£æ
        for (let j = 0; j < line.length; j++) {
          const c = line[j];
          
          if (c === '"' && !inQuotes) {
            // è¿›å…¥å¼•å·
            inQuotes = true;
          } else if (c === '"' && inQuotes && line[j + 1] === '"') {
            // è½¬ä¹‰çš„å¼•å·ï¼ˆä¸¤ä¸ªå¼•å·è¡¨ç¤ºä¸€ä¸ªå¼•å·ï¼‰
            field += '"';
            j++; // è·³è¿‡ä¸‹ä¸€ä¸ªå¼•å·
          } else if (c === '"' && inQuotes) {
            // é€€å‡ºå¼•å·
            inQuotes = false;
          } else if (c === ',' && !inQuotes) {
            // å­—æ®µåˆ†éš”ç¬¦ï¼ˆä»…åœ¨å¼•å·å¤–æœ‰æ•ˆï¼‰
            row.push(field.trim().replace(/^"(.*)"$/, '$1'));
            field = '';
          } else {
            // æ™®é€šå­—ç¬¦
            field += c;
          }
        }
        
        // æ·»åŠ æœ€åä¸€ä¸ªå­—æ®µ
        row.push(field.trim().replace(/^"(.*)"$/, '$1'));
        
        // åªæœ‰å­—æ®µæ•°åŒ¹é…è¡¨å¤´æ•°æ‰æ·»åŠ åˆ°æ•°æ®ä¸­
        if (row.length === headers.length) {
          data.push(row);
        }
      }
      
      return { headers, data };
    }

    /**
     * å¯¼å…¥CSVæ•°æ®åˆ°è¡¨æ ¼
     * @param {Array} headers - CSVè¡¨å¤´æ•°ç»„
     * @param {Array} data - CSVæ•°æ®è¡Œæ•°ç»„
     * 
     * åŠŸèƒ½ï¼šå°†è§£æåçš„CSVæ•°æ®å¯¼å…¥åˆ°å½“å‰è¡¨æ ¼ä¸­
     * ç®—æ³•æµç¨‹ï¼š
     * 1. ä¿å­˜å½“å‰çŠ¶æ€ï¼ˆç”¨äºæ’¤é”€ï¼‰
     * 2. æ ¹æ®ç”¨æˆ·é€‰æ‹©å†³å®šæ˜¯å¦æ¸…ç©ºç°æœ‰æ•°æ®
     * 3. åŠ¨æ€æ·»åŠ æ–°åˆ—ï¼ˆå¦‚æœCSVä¸­æœ‰æ–°åˆ—ï¼‰
     * 4. è§£ææ¯è¡Œæ•°æ®å¹¶æ˜ å°„åˆ°æ•°æ®å¯¹è±¡
     * 5. è‡ªåŠ¨è®¡ç®—é™„åŠ ä»·æ ¼
     * 6. æŒ‰ç¼–å·æ’åºå¹¶é‡ç½®åˆ°ç¬¬ä¸€é¡µ
     * 
     * ç‰¹æ®Šå¤„ç†ï¼š
     * - æ”¯æŒå¢é‡å¯¼å…¥å’Œæ›¿æ¢å¯¼å…¥ä¸¤ç§æ¨¡å¼
     * - è‡ªåŠ¨å¤„ç†åˆ—çš„åŠ¨æ€æ·»åŠ 
     * - æ™ºèƒ½ç¼–å·ç”Ÿæˆ
     */
    function importCSV(headers, data) {
      // ç¬¬ä¸€æ­¥ï¼šä¿å­˜çŠ¶æ€ï¼ˆç”¨äºæ’¤é”€ï¼‰
      saveState();

      // ç¬¬äºŒæ­¥ï¼šå¤„ç†å¯¼å…¥æ¨¡å¼ï¼ˆæ¸…ç©ºæˆ–è¿½åŠ ï¼‰
      if (clearBeforeImportCheckbox.checked) {
        // æ¸…ç©ºæ¨¡å¼ï¼šé‡ç½®æ‰€æœ‰æ•°æ®
        allData = [];
        // é‡ç½®BASE_COLUMNSä¸ºé»˜è®¤å€¼
        BASE_COLUMNS.length = 0;
        BASE_COLUMNS.push(...['ç¼–å·', 'ç³»ç»Ÿç±»å‹', 'å°ºå¯¸', 'é…ç½®å‚æ•°', 'åŸä»·+85', 'åŸä»·']);
      }

      // ç¬¬ä¸‰æ­¥ï¼šåŠ¨æ€æ·»åŠ æ–°åˆ—
      headers.forEach(header => {
        if (!BASE_COLUMNS.includes(header)) {
          BASE_COLUMNS.push(header);
        }
      });

      // ç¬¬å››æ­¥ï¼šè§£æCSVæ•°æ®
      data.forEach(rowData => {
        const item = {};
        
        // å°†CSVè¡Œæ•°æ®æ˜ å°„åˆ°å¯¹è±¡å±æ€§
        headers.forEach((header, index) => {
          if (header === 'ç¼–å·') {
            // ç¼–å·å¤„ç†ï¼šæ¸…ç©ºæ¨¡å¼ä½¿ç”¨CSVä¸­çš„ç¼–å·ï¼Œè¿½åŠ æ¨¡å¼ç”Ÿæˆæ–°ç¼–å·
            item.serialNumber = clearBeforeImportCheckbox.checked ? 
              (rowData[index] ? parseInt(rowData[index]) : getNextSerialNumber()) : 
              getNextSerialNumber();
          } else if (header === 'ç³»ç»Ÿç±»å‹') {
            item.systemType = rowData[index] || '';
          } else if (header === 'å°ºå¯¸') {
            item.size = rowData[index] || '';
          } else if (header === 'é…ç½®å‚æ•°') {
            item.configParam = rowData[index] || '';
          } else if (header === 'åŸä»·+85') {
            item.computedPrice = parseFloat(rowData[index]) || 0;
          } else if (header === 'åŸä»·') {
            item.price = parseFloat(rowData[index]) || 0;
          } else {
            // è‡ªå®šä¹‰åˆ—ï¼šä½¿ç”¨CSVä¸­çš„å€¼æˆ–ç©ºå­—ç¬¦ä¸²
            item[header] = rowData[index] || '';
          }
        });
        
        // ç¬¬äº”æ­¥ï¼šè®¡ç®—é™„åŠ ä»·æ ¼ï¼ˆä»…å¯¹æ¸…ç©ºæ¨¡å¼ï¼‰
        if (clearBeforeImportCheckbox.checked) {
          const addon = parseFloat(addonInput.value) || 0;
          if (!item.hasOwnProperty('computedPrice')) {
            item.computedPrice = (item.price || 0) + addon;
          }
        }
        
        // ç¬¬å…­æ­¥ï¼šæ·»åŠ åˆ°æ•°æ®æ•°ç»„
        allData.push(item);
      });

      // ç¬¬ä¸ƒæ­¥ï¼šæ’åºå’Œé¡µé¢é‡ç½®
      const isAscending = importSortAscCheckbox.checked;
      sortTableByColumn(2, isAscending); // æŒ‰ç¼–å·æ’åº
      
      currentPage = 1; // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
      renderTable();
      updatePagination();
    }

    /**
     * å¤„ç†CSVæ–‡ä»¶å¯¼å…¥
     * @param {Event} event - æ–‡ä»¶é€‰æ‹©äº‹ä»¶å¯¹è±¡
     * 
     * åŠŸèƒ½ï¼šè¯»å–ç”¨æˆ·é€‰æ‹©çš„CSVæ–‡ä»¶å¹¶å¯¼å…¥æ•°æ®
     * ç®—æ³•æµç¨‹ï¼š
     * 1. è·å–é€‰æ‹©çš„æ–‡ä»¶
     * 2. ä½¿ç”¨FileReaderè¯»å–æ–‡ä»¶å†…å®¹
     * 3. è§£æCSVæ–‡æœ¬
     * 4. è°ƒç”¨importCSVå¯¼å…¥æ•°æ®
     * 5. æ¸…ç©ºæ–‡ä»¶è¾“å…¥æ¡†
     * 
     * é”™è¯¯å¤„ç†ï¼š
     * - æ–‡ä»¶ä¸ºç©ºæ—¶æ˜¾ç¤ºé”™è¯¯æç¤º
     * - æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®æ—¶æ˜¾ç¤ºé”™è¯¯æç¤º
     */
    function handleCSVImport(event) {
      // ç¬¬ä¸€æ­¥ï¼šè·å–æ–‡ä»¶
      const file = event.target.files[0];
      if (!file) return;
      
      // ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ–‡ä»¶è¯»å–å™¨
      const reader = new FileReader();
      
      // ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®è¯»å–å®Œæˆå›è°ƒ
      reader.onload = (e) => {
        const text = e.target.result;
        
        // ç¬¬å››æ­¥ï¼šè§£æCSVå†…å®¹
        const { headers, data } = parseCSV(text);
        
        // ç¬¬äº”æ­¥ï¼šéªŒè¯æ•°æ®æœ‰æ•ˆæ€§
        if (data.length === 0) {
          alert('CSV æ–‡ä»¶ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®ï¼');
          return;
        }
        
        // ç¬¬å…­æ­¥ï¼šå¯¼å…¥æ•°æ®
        importCSV(headers, data);
      };
      
      // ç¬¬ä¸ƒæ­¥ï¼šå¼€å§‹è¯»å–æ–‡ä»¶ï¼ˆä½¿ç”¨UTF-8ç¼–ç ï¼‰
      reader.readAsText(file, 'utf-8');
      
      // ç¬¬å…«æ­¥ï¼šæ¸…ç©ºæ–‡ä»¶è¾“å…¥æ¡†ï¼Œå…è®¸é‡å¤é€‰æ‹©åŒä¸€æ–‡ä»¶
      csvFileInput.value = '';
    }

    // === æ‰¹é‡åˆ é™¤æ¨¡å— ===
    
    /**
     * å¤„ç†æ‰¹é‡åˆ é™¤æ“ä½œ
     * åŠŸèƒ½ï¼šåˆ é™¤æ‰€æœ‰é€‰ä¸­çš„è¡Œï¼Œå¹¶é‡æ–°ç¼–å·
     * ç®—æ³•æµç¨‹ï¼š
     * 1. è·å–æ‰€æœ‰é€‰ä¸­çš„è¡Œ
     * 2. ç”¨æˆ·ç¡®è®¤åˆ é™¤æ“ä½œ
     * 3. ä¿å­˜çŠ¶æ€ï¼ˆç”¨äºæ’¤é”€ï¼‰
     * 4. æ”¶é›†è¦åˆ é™¤çš„è¡Œç´¢å¼•
     * 5. æŒ‰é™åºåˆ é™¤ï¼ˆé¿å…ç´¢å¼•å˜åŒ–å½±å“ï¼‰
     * 6. é‡æ–°ç¼–å·æ‰€æœ‰å‰©ä½™è¡Œ
     * 7. é‡æ–°æ¸²æŸ“ç•Œé¢
     * 8. å–æ¶ˆå…¨é€‰çŠ¶æ€
     * 
     * è¾¹ç•Œæ¡ä»¶ï¼š
     * - æ²¡æœ‰é€‰ä¸­è¡Œæ—¶ä¸æ‰§è¡Œæ“ä½œ
     * - åˆ é™¤åéœ€è¦é‡æ–°ç¼–å·
     * - åˆ é™¤åè‡ªåŠ¨å–æ¶ˆå…¨é€‰çŠ¶æ€
     */
    function handleBulkDelete() {
      // ç¬¬ä¸€æ­¥ï¼šè·å–é€‰ä¸­çš„è¡Œ
      const checkedBoxes = document.querySelectorAll('#tableBody .row-checkbox:checked');
      if (checkedBoxes.length === 0) return;

      // ç¬¬äºŒæ­¥ï¼šç”¨æˆ·ç¡®è®¤
      if (!confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${checkedBoxes.length} è¡Œå—ï¼Ÿ`)) {
        // ç”¨æˆ·å–æ¶ˆåˆ é™¤æ—¶ï¼Œä¹Ÿè¦å–æ¶ˆå…¨é€‰çŠ¶æ€
        clearAllSelections();
        return;
      }

      // ç¬¬ä¸‰æ­¥ï¼šä¿å­˜çŠ¶æ€ï¼ˆç”¨äºæ’¤é”€ï¼‰
      saveState();
      
      // ç¬¬å››æ­¥ï¼šæ”¶é›†è¦åˆ é™¤çš„è¡Œç´¢å¼•
      const indicesToDelete = [];
      checkedBoxes.forEach(checkbox => {
        const rowIndex = parseInt(checkbox.closest('tr').dataset.index);
        indicesToDelete.push(rowIndex);
      });
      
      // ç¬¬äº”æ­¥ï¼šæŒ‰é™åºæ’åˆ—ç´¢å¼•ï¼Œä»åå¾€å‰åˆ é™¤
      // è¿™æ ·å¯ä»¥é¿å…åˆ é™¤å‰é¢å…ƒç´ åå½±å“åé¢å…ƒç´ çš„ç´¢å¼•
      indicesToDelete.sort((a, b) => b - a);
      indicesToDelete.forEach(index => {
        allData.splice(index, 1);
      });
      
      // ç¬¬å…­æ­¥ï¼šé‡æ–°ç¼–å·æ‰€æœ‰å‰©ä½™è¡Œ
      allData.forEach((item, index) => {
        item.serialNumber = index + 1;
      });
      
      // ç¬¬ä¸ƒæ­¥ï¼šå–æ¶ˆå…¨é€‰çŠ¶æ€
      clearAllSelections();
      
      // ç¬¬å…«æ­¥ï¼šé‡æ–°æ¸²æŸ“ç•Œé¢
      // åˆ¤æ–­å½“å‰é¡µæ˜¯å¦è¿˜æœ‰æ•°æ®ï¼Œæ²¡æœ‰åˆ™è‡ªåŠ¨è·³è½¬ä¸Šä¸€é¡µï¼ˆä½†ç¬¬ä¸€é¡µä¸è·³è½¬ï¼‰
      const totalPages = Math.ceil(allData.length / ROWS_PER_PAGE) || 1;
      if (currentPage > totalPages) {
        currentPage = Math.max(1, totalPages);
      }
      renderTable();
      updatePagination();
      updateBulkDeleteButton();
    }

    /**
     * æ¸…é™¤æ‰€æœ‰é€‰æ‹©çŠ¶æ€
     * åŠŸèƒ½ï¼šå–æ¶ˆå…¨é€‰å¤é€‰æ¡†å’Œæ‰€æœ‰è¡Œå¤é€‰æ¡†çš„é€‰ä¸­çŠ¶æ€
     */
    function clearAllSelections() {
      // å–æ¶ˆå…¨é€‰å¤é€‰æ¡†
      const selectAllCheckbox = document.getElementById('selectAll');
      if (selectAllCheckbox.checked) {
        selectAllCheckbox.checked = false;
      }
      
      // å–æ¶ˆæ‰€æœ‰è¡Œå¤é€‰æ¡†
      const rowCheckboxes = document.querySelectorAll('#tableBody .row-checkbox:checked');
      rowCheckboxes.forEach(checkbox => {
        checkbox.checked = false;
      });
      
      // æ›´æ–°æ‰¹é‡åˆ é™¤æŒ‰é’®çŠ¶æ€
      updateBulkDeleteButton();
    }

    // === åˆ†é¡µåŠŸèƒ½æ¨¡å— ===
    
    /**
     * æ›´æ–°åˆ†é¡µæ§ä»¶çŠ¶æ€
     * åŠŸèƒ½ï¼šæ›´æ–°åˆ†é¡µç›¸å…³çš„æ‰€æœ‰UIå…ƒç´ 
     * ç®—æ³•æµç¨‹ï¼š
     * 1. è®¡ç®—æ€»é¡µæ•°
     * 2. æ›´æ–°é¡µé¢ä¿¡æ¯æ˜¾ç¤º
     * 3. æ›´æ–°ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µæŒ‰é’®çŠ¶æ€
     * 4. åŠ¨æ€ç”Ÿæˆé¡µç æŒ‰é’®ï¼ˆå½“å‰é¡µÂ±2çš„èŒƒå›´ï¼‰
     * 
     * è¾¹ç•Œæ¡ä»¶ï¼š
     * - æ€»é¡µæ•°ä¸º0æ—¶æ˜¾ç¤ºä¸º1
     * - å½“å‰é¡µè¶…å‡ºèŒƒå›´æ—¶è‡ªåŠ¨è°ƒæ•´
     */
    function updatePagination() {
      // ç¬¬ä¸€æ­¥ï¼šè®¡ç®—æ€»é¡µæ•°
      const totalPages = Math.ceil(allData.length / ROWS_PER_PAGE);
      
      // ç¬¬äºŒæ­¥ï¼šæ›´æ–°é¡µé¢ä¿¡æ¯æ˜¾ç¤º
      document.getElementById('totalPages').textContent = totalPages || 1;
      document.getElementById('currentPage').textContent = currentPage;
      document.getElementById('totalRows').textContent = allData.length;
      
      // ç¬¬ä¸‰æ­¥ï¼šæ›´æ–°ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µæŒ‰é’®çŠ¶æ€
      document.getElementById('prevPage').disabled = currentPage <= 1;
      document.getElementById('nextPage').disabled = currentPage >= totalPages;
      
      // ç¬¬å››æ­¥ï¼šæ›´æ–°é¡µç æŒ‰é’®
      const pageButtonsContainer = document.querySelector('.page-buttons');
      
      // æ¸…é™¤é™¤ä¸Šä¸€é¡µå’Œä¸‹ä¸€é¡µæŒ‰é’®å¤–çš„æ‰€æœ‰é¡µç æŒ‰é’®
      const buttons = pageButtonsContainer.querySelectorAll('.page-btn:not(#prevPage):not(#nextPage)');
      buttons.forEach(btn => btn.remove());
      
      // ç¬¬äº”æ­¥ï¼šåªæ˜¾ç¤ºå½“å‰é¡µå’Œä¸‹ä¸€ä¸ªé¡µï¼ˆå¦‚æœæœ‰ï¼‰
      if (totalPages > 0) {
        let pages = [currentPage];
        if (currentPage < totalPages) pages.push(currentPage + 1);
        // å¦‚æœä¸æ˜¯ç¬¬ä¸€é¡µï¼Œæ˜¾ç¤ºå‰ä¸€é¡µ
        if (currentPage > 1) pages = [currentPage - 1, ...pages];
        // åªä¿ç•™æœ€å¤šä¸¤ä¸ªé¡µç 
        pages = pages.slice(0, 2);
        pages.forEach(i => {
          const pageBtn = document.createElement('button');
          pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
          pageBtn.id = `page${i}`;
          pageBtn.textContent = i;
          pageBtn.onclick = () => goToPage(i);
          document.getElementById('nextPage').before(pageBtn);
        });
      }
    }

    /**
     * è·³è½¬åˆ°æŒ‡å®šé¡µé¢
     * @param {number} page - ç›®æ ‡é¡µç 
     * 
     * åŠŸèƒ½ï¼šåˆ‡æ¢åˆ°æŒ‡å®šé¡µé¢å¹¶é‡æ–°æ¸²æŸ“
     * è¾¹ç•Œæ¡ä»¶ï¼š
     * - é¡µç å°äº1æ—¶ä¸æ‰§è¡Œè·³è½¬
     * - é¡µç å¤§äºæ€»é¡µæ•°æ—¶ä¸æ‰§è¡Œè·³è½¬
     */
    function goToPage(page) {
      // éªŒè¯é¡µç æœ‰æ•ˆæ€§
      if (page < 1 || page > Math.ceil(allData.length / ROWS_PER_PAGE)) return;
      
      // æ›´æ–°å½“å‰é¡µç 
      currentPage = page;
      
      // é‡æ–°æ¸²æŸ“è¡¨æ ¼å’Œåˆ†é¡µæ§ä»¶
      renderTable();
      updatePagination();
    }

    /**
     * æ¸²æŸ“è¡¨æ ¼æ•°æ®
     * åŠŸèƒ½ï¼šæ ¹æ®å½“å‰é¡µç æ¸²æŸ“å¯¹åº”çš„æ•°æ®è¡Œ
     * ç®—æ³•æµç¨‹ï¼š
     * 1. æ¸…ç©ºç°æœ‰è¡¨æ ¼å†…å®¹
     * 2. è®¡ç®—å½“å‰é¡µçš„æ•°æ®èŒƒå›´
     * 3. éå†æ•°æ®ç”ŸæˆHTMLè¡Œ
     * 4. å¤„ç†åŸºç¡€åˆ—å’Œè‡ªå®šä¹‰åˆ—
     * 5. ç»‘å®šè¡Œäº‹ä»¶å¤„ç†å™¨
     * 
     * æ€§èƒ½ä¼˜åŒ–ï¼š
     * - åªæ¸²æŸ“å½“å‰é¡µçš„æ•°æ®
     * - ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥å‡å°‘DOMæ“ä½œ
     */
    function renderTable() {
      // ç¬¬ä¸€æ­¥ï¼šè·å–è¡¨æ ¼ä½“å¹¶æ¸…ç©º
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';
      
      // ç¬¬äºŒæ­¥ï¼šè®¡ç®—å½“å‰é¡µçš„æ•°æ®èŒƒå›´
      const startIndex = (currentPage - 1) * ROWS_PER_PAGE;
      const endIndex = Math.min(startIndex + ROWS_PER_PAGE, allData.length);
      
      // ç¬¬ä¸‰æ­¥ï¼šæ¸²æŸ“å½“å‰é¡µçš„æ•°æ®è¡Œ
      for (let i = startIndex; i < endIndex; i++) {
        const item = allData[i];
        const row = document.createElement('tr');
        row.dataset.index = i; // å­˜å‚¨æ•°æ®ç´¢å¼•ï¼Œç”¨äºç¼–è¾‘å’Œåˆ é™¤æ“ä½œ
        
        // ç¬¬å››æ­¥ï¼šæ„å»ºåŸºç¡€åˆ—çš„HTML
        let rowHTML = `
          <td class="row-select"><input type="checkbox" class="row-checkbox"></td>
          <td class="serial-number">${item.serialNumber}</td>
          <td>
            ${item.systemType === 'Android' ? '<span class="system-icon" title="Android">ğŸ¤–</span>' : item.systemType === 'Windows' ? '<span class="system-icon" title="Windows">ğŸªŸ</span>' : ''}
          </td>
          <td>${item.size}</td>
          <td>${item.configParam}</td>
          <td class="computed-cell">${item.computedPrice.toFixed(2)}</td>
          <td>
            <input type="text" class="flat-price-input" value="${item.price.toFixed(2)}" readonly ondblclick="editPriceInput(this, ${i})" style="text-align:center; width:80px; border:none; background:transparent; outline:none; font-size:14px; cursor:pointer; padding:8px 0; transition:background 0.2s; border-radius:6px;" />
          </td>
        `;
        
        // ç¬¬äº”æ­¥ï¼šæ·»åŠ è‡ªå®šä¹‰åˆ—
        // ä»ç¬¬6åˆ—å¼€å§‹ï¼ˆè·³è¿‡åŸºç¡€åˆ—ï¼‰ï¼Œæ£€æŸ¥æ˜¯å¦ä¸ºè‡ªå®šä¹‰åˆ—
        for (let j = 6; j < BASE_COLUMNS.length; j++) {
          const colName = BASE_COLUMNS[j];
          // æ’é™¤åŸºç¡€åˆ—ï¼Œåªå¤„ç†è‡ªå®šä¹‰åˆ—
          if (colName !== 'ç¼–å·' && colName !== 'ç³»ç»Ÿç±»å‹' && colName !== 'å°ºå¯¸' && 
              colName !== 'é…ç½®å‚æ•°' && colName !== 'åŸä»·+85' && colName !== 'åŸä»·') {
            rowHTML += `<td>${item[colName] || ''}</td>`;
          }
        }
        
        // ç¬¬å…­æ­¥ï¼šæ·»åŠ æ“ä½œåˆ—
        rowHTML += `
          <td>
            <button class="edit-row-btn">ç¼–è¾‘</button>
            <button class="delete-row-btn">åˆ é™¤</button>
          </td>
        `;
        
        // ç¬¬ä¸ƒæ­¥ï¼šè®¾ç½®è¡ŒHTMLå¹¶æ·»åŠ åˆ°è¡¨æ ¼
        row.innerHTML = rowHTML;
        tbody.appendChild(row);
      }
      
      // ç¬¬å…«æ­¥ï¼šç»‘å®šå½“å‰é¡µè¡Œçš„äº‹ä»¶å¤„ç†å™¨
      initRowEvents();
    // ...existing code...

    // æ”¯æŒåŒå‡»åŸä»·å•å…ƒæ ¼ç›´æ¥ç¼–è¾‘
    window.editPriceInput = function(input, rowIndex) {
      input.readOnly = false;
      input.style.background = '#f1f5f9';
      input.style.border = '1.5px solid #4361ee';
      input.style.cursor = 'text';
      input.focus();
      input.select();
      // å¤±ç„¦æˆ–å›è½¦ä¿å­˜
      function save() {
        const val = parseFloat(input.value);
        if (!isNaN(val)) {
          allData[rowIndex].price = val;
          allData[rowIndex].computedPrice = val + (parseFloat(addonInput.value) || 0);
        }
        input.readOnly = true;
        input.style.background = 'transparent';
        input.style.border = 'none';
        input.style.cursor = 'pointer';
        renderTable();
        updatePagination();
      }
      input.onblur = save;
      input.onkeydown = function(e) {
        if (e.key === 'Enter') input.blur();
        if (e.key === 'Escape') {
          input.value = allData[rowIndex].price.toFixed(2);
          input.blur();
        }
      };
    };
    }

    /**
     * åˆå§‹åŒ–è¡¨æ ¼è¡Œçš„äº‹ä»¶å¤„ç†å™¨
     * åŠŸèƒ½ï¼šä¸ºå½“å‰é¡µçš„æ‰€æœ‰è¡Œç»‘å®šäº‹ä»¶å¤„ç†å™¨
     * ç»‘å®šçš„äº‹ä»¶ï¼š
     * 1. ç¼–è¾‘æŒ‰é’®ç‚¹å‡»äº‹ä»¶
     * 2. åˆ é™¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
     * 3. è¡Œé€‰æ‹©å¤é€‰æ¡†äº‹ä»¶
     * 4. å…¨é€‰å¤é€‰æ¡†äº‹ä»¶
     * 
     * æ€§èƒ½ä¼˜åŒ–ï¼š
     * - åªä¸ºå½“å‰é¡µçš„å…ƒç´ ç»‘å®šäº‹ä»¶
     * - ç§»é™¤æ—§äº‹ä»¶ç›‘å¬å™¨é¿å…é‡å¤ç»‘å®š
     */
    function initRowEvents() {
      // ç¬¬ä¸€æ­¥ï¼šç»‘å®šç¼–è¾‘æŒ‰é’®äº‹ä»¶
      document.querySelectorAll('#tableBody .edit-row-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const row = btn.closest('tr');
          openEditModal(row);
        });
      });
      
      // ç¬¬äºŒæ­¥ï¼šç»‘å®šåˆ é™¤æŒ‰é’®äº‹ä»¶
      document.querySelectorAll('#tableBody .delete-row-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const row = btn.closest('tr');
          const rowIndex = parseInt(row.dataset.index);
          
          // ç”¨æˆ·ç¡®è®¤åˆ é™¤
          if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸€è¡Œå—ï¼Ÿ')) {
            // ä¿å­˜çŠ¶æ€ï¼ˆç”¨äºæ’¤é”€ï¼‰
            saveState();
            
            // ä»æ•°æ®æ•°ç»„ä¸­åˆ é™¤å¯¹åº”é¡¹
            allData.splice(rowIndex, 1);
            
            // é‡æ–°ç¼–å·æ‰€æœ‰å‰©ä½™è¡Œ
            allData.forEach((item, index) => {
              item.serialNumber = index + 1;
            });
            
            // é‡æ–°æ¸²æŸ“ç•Œé¢
            renderTable();
            updatePagination();
            updateBulkDeleteButton();
          }
        });
      });
      
      // ç¬¬ä¸‰æ­¥ï¼šç»‘å®šè¡Œé€‰æ‹©å¤é€‰æ¡†äº‹ä»¶
      document.querySelectorAll('.row-checkbox').forEach(cb => {
        // å…ˆç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
        cb.removeEventListener('change', updateBulkDeleteButton);
        // ç»‘å®šæ–°çš„äº‹ä»¶ç›‘å¬å™¨
        cb.addEventListener('change', updateBulkDeleteButton);
      });
      
      // ç¬¬å››æ­¥ï¼šæ›´æ–°å…¨é€‰å¤é€‰æ¡†äº‹ä»¶
      const selectAllCheckbox = document.getElementById('selectAll');
      selectAllCheckbox.onchange = function() {
        const checkboxes = document.querySelectorAll('#tableBody .row-checkbox');
        // åŒæ­¥æ‰€æœ‰è¡Œå¤é€‰æ¡†çš„çŠ¶æ€
        checkboxes.forEach(cb => cb.checked = this.checked);
        // æ›´æ–°æ‰¹é‡åˆ é™¤æŒ‰é’®çŠ¶æ€
        updateBulkDeleteButton();
      };
    }

    // === äº‹ä»¶ç»‘å®šæ¨¡å— ===
    
    /**
     * ç»‘å®šæ‰€æœ‰UIæ§ä»¶çš„äº‹ä»¶å¤„ç†å™¨
     * åŠŸèƒ½ï¼šä¸ºé¡µé¢çš„æ‰€æœ‰äº¤äº’å…ƒç´ ç»‘å®šç›¸åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°
     * 
     * äº‹ä»¶åˆ†ç±»ï¼š
     * 1. å·¥å…·æ æŒ‰é’®äº‹ä»¶
     * 2. æ¨¡æ€æ¡†äº‹ä»¶
     * 3. åˆ†é¡µæ§ä»¶äº‹ä»¶
     * 4. æ•°æ®è¾“å…¥äº‹ä»¶
     * 5. æ–‡ä»¶æ“ä½œäº‹ä»¶
     */
    
    // å·¥å…·æ æŒ‰é’®äº‹ä»¶ç»‘å®š
    document.getElementById('addRowBtn').addEventListener('click', openAddModal);
    document.getElementById('addColumnBtn').addEventListener('click', () => {
      const name = prompt('è¯·è¾“å…¥æ–°åˆ—åï¼š');
      if (name) addColumn(name);
    });
    document.getElementById('exportBtn').addEventListener('click', exportToCSV);
    document.getElementById('importBtn').addEventListener('click', () => csvFileInput.click());
    document.getElementById('undoBtn').addEventListener('click', restoreState);
    document.getElementById('bulkDeleteBtn').addEventListener('click', handleBulkDelete);
    
    // æ–‡ä»¶æ“ä½œäº‹ä»¶ç»‘å®š
    csvFileInput.addEventListener('change', handleCSVImport);
    
    // æ¨¡æ€æ¡†äº‹ä»¶ç»‘å®š
    // ä¿®å¤ï¼šæ‰€æœ‰ä¸»å¼¹çª—å…³é—­æŒ‰é’®éƒ½ç»‘å®šå…³é—­äº‹ä»¶
    modalCloseBtns.forEach(btn => btn.addEventListener('click', closeModalFn));
    // ä¿®å¤ï¼šç‚¹å‡»ä¸»å¼¹çª—é®ç½©å±‚å…³é—­å¼¹çª—
    document.getElementById('modal').addEventListener('click', function(e) {
      if (e.target === this) closeModalFn();
    });
    cancelBtn.addEventListener('click', closeModalFn);
    confirmBtn.addEventListener('click', handleConfirm);
    
    // æ•°æ®è¾“å…¥äº‹ä»¶ç»‘å®š
    addonInput.addEventListener('input', updateComputedCells);
    
    // åˆ†é¡µæ§ä»¶äº‹ä»¶ç»‘å®š
    document.getElementById('prevPage').addEventListener('click', () => goToPage(currentPage - 1));
    document.getElementById('nextPage').addEventListener('click', () => goToPage(currentPage + 1));

    // === åˆå§‹åŒ–æ¨¡å— ===
    
    /**
     * åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®
     * åŠŸèƒ½ï¼šæä¾›åˆå§‹çš„ç¤ºä¾‹æ•°æ®ä¾›ç”¨æˆ·å‚è€ƒå’Œæµ‹è¯•
     * æ•°æ®åŒ…å«ï¼šWindowså’ŒAndroidç³»ç»Ÿçš„å„ç§é…ç½®å’Œä»·æ ¼
     * å·²ç§»é™¤å‡æ•°æ®ï¼Œåˆå§‹åŒ–ä¸ºç©ºæ•°ç»„
     */
    allData = [];

    /**
     * åº”ç”¨åˆå§‹åŒ–
     * åŠŸèƒ½ï¼šåœ¨é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œåˆå§‹åŒ–æ“ä½œ
     * åˆå§‹åŒ–æ­¥éª¤ï¼š
     * 1. æ¸²æŸ“åˆå§‹è¡¨æ ¼æ•°æ®
     * 2. æ›´æ–°åˆ†é¡µæ§ä»¶
     * 3. è®¾ç½®æ’¤é”€æŒ‰é’®çŠ¶æ€
     * 4. è®¾ç½®æ‰¹é‡åˆ é™¤æŒ‰é’®çŠ¶æ€
     */
    renderTable();
    updatePagination();
    updateUndoButton();
    updateBulkDeleteButton();
    
    /**
     * ä»£ç æ•´ä½“æµç¨‹æ€»ç»“ï¼š
     * 
     * 1. æ•°æ®ç®¡ç†å±‚ï¼š
     *    - allDataæ•°ç»„å­˜å‚¨æ‰€æœ‰æŠ¥ä»·è®°å½•
     *    - æ”¯æŒå¢åˆ æ”¹æŸ¥æ“ä½œ
     *    - è‡ªåŠ¨ç¼–å·å’Œä»·æ ¼è®¡ç®—
     * 
     * 2. ç•Œé¢æ¸²æŸ“å±‚ï¼š
     *    - åˆ†é¡µæ˜¾ç¤ºæ•°æ®ï¼ˆæ¯é¡µ10æ¡ï¼‰
     *    - åŠ¨æ€ç”Ÿæˆè¡¨æ ¼HTML
     *    - å“åº”å¼UIæ›´æ–°
     * 
     * 3. äº¤äº’æ§åˆ¶å±‚ï¼š
     *    - æ¨¡æ€æ¡†è¡¨å•æ“ä½œ
     *    - æ’åºå’Œç­›é€‰åŠŸèƒ½
     *    - æ‰¹é‡æ“ä½œæ”¯æŒ
     * 
     * 4. æ•°æ®æŒä¹…åŒ–å±‚ï¼š
     *    - CSVå¯¼å…¥å¯¼å‡ºåŠŸèƒ½
     *    - æ“ä½œå†å²ç®¡ç†ï¼ˆæ’¤é”€ï¼‰
     *    - æ•°æ®æ ¼å¼è½¬æ¢
     * 
     * 5. æ‰©å±•åŠŸèƒ½å±‚ï¼š
     *    - åŠ¨æ€åˆ—ç®¡ç†
     *    - è‡ªå®šä¹‰è®¡ç®—å­—æ®µ
     *    - æ™ºèƒ½æ’åºç®—æ³•
     * 
     * è¾¹ç•Œæ¡ä»¶å¤„ç†ï¼š
     * - ç©ºæ•°æ®å¤„ç†
     * - æ— æ•ˆè¾“å…¥éªŒè¯
     * - å¹¶å‘æ“ä½œä¿æŠ¤
     * - å†…å­˜ä½¿ç”¨ä¼˜åŒ–
     */
  </script>
</body>
</html>



